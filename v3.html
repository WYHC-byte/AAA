<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <title>Jork-v3 AIÂä©Êâã</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ÂëΩ‰ª§Èù¢ÊùøÊ†∑Âºè */
.command-palette {
    position: absolute;
    bottom: 80px;
    right: 20px;
    background: var(--light-card);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    width: 200px;
    z-index: 1000;
}

.command-item {
    padding: 10px;
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 10px;
}

.command-item:hover {
    background: rgba(123,104,238,0.1);
}
        .search-results {
    border-left: 3px solid #4CAF50;
    padding: 15px;
    margin: 10px 0;
    background: rgba(76,175,80,0.05);
    border-radius: 8px;
}

.search-abstract {
    color: #666;
    margin-bottom: 12px;
    line-height: 1.6;
}

.related-results ul {
    padding-left: 20px;
    margin-top: 8px;
}

.related-results li {
    margin-bottom: 6px;
    padding-left: 8px;
}
        /* Âü∫Êú¨Ê†∑Âºè */
    body {
      margin: 0;
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background-color: #f5f7fb;
    }
    .header {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      background-color: #fff;
      border-bottom: 1px solid #e0e0e0;
    }
    .left-header {
      display: flex;
      align-items: center;
      flex-shrink: 0;
    }
    .credits {
      margin-left: auto;
      display: flex;
      align-items: center;
    }
    .credits i {
      margin-right: 8px;
      color: #ffc107;
    }
    .credits span {
      margin-right: 10px;
      font-weight: 600;
    }
    .model-select {
      padding: 6px 10px;
      font-size: 0.9em;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      background-color: #f5f7fb;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%237b68ee' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 14px;
    }
    .model-select:focus {
      outline: none;
      border-color: #7b68ee;
      box-shadow: 0 0 0 2px rgba(123,104,238,0.2);
    }
        /* ÈìæÊé•ÂÆπÂô®Ê†∑Âºè */
.footer-links-container {
    padding: 15px 0;
    border-top: 1px solid var(--light-border);
    margin-top: 15px;
}

/* ÈÄöÁî®ÈìæÊé•Ê†∑Âºè */
.footer-links-container a {
    color: var(--light-text);
    text-decoration: none;
    font-size: 0.9em;
    transition: color 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 0;
}

.footer-links-container a:hover {
    color: var(--primary-color);
}

/* Ê†áÈ¢òÊ†∑Âºè */
.footer-links-container h4 {
    color: var(--primary-color);
    font-size: 0.95em;
    margin: 15px 0 10px;
    font-weight: 600;
}

/* ÂàÜÈöîÁ∫øÊ†∑Âºè */
.dot-divider {
    color: var(--light-border);
    padding: 0 5px;
    font-weight: bold;
}

/* ‰ø°ÊÅØÈìæÊé•Ë°åÊ†∑Âºè */
.info-links {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 5px;
}

/* ÂæÆ‰ø°ÂÖ¨‰ºóÂè∑ÊÇ¨ÊµÆÊèêÁ§∫ */
.wechat-link {
    position: relative;
}

.wechat-link:hover::after {
    content: "Êâ´Á†ÅÂÖ≥Ê≥®";
    position: absolute;
    left: 0;
    bottom: 100%;
    background: var(--light-card);
    padding: 6px 10px;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    font-size: 0.8em;
    white-space: nowrap;
}

/* ÁßªÂä®Á´ØÈÄÇÈÖç */
@media (max-width: 768px) {
    .footer-links-container {
        padding: 10px;
    }
    
    .info-links {
        justify-content: center;
    }
}
        .message-content {
    white-space: pre-wrap;
    word-wrap: break-word;
    line-height: 1.6;
}

.message-content p {
    margin: 8px 0;
}
    .message-heading {
        font-size: 1.4rem;
        margin: 15px 0 10px;
        color: var(--primary-color);
        border-bottom: 2px solid rgba(123, 104, 238, 0.2);
        padding-bottom: 5px;
    }

    .message-subheading {
        font-size: 1.2rem;
        margin: 12px 0 8px;
        color: var(--secondary-color);
    }

.thinking-process {
    background: linear-gradient(145deg, rgba(123,104,238,0.08) 0%, rgba(123,104,238,0.03) 100%);
    border: 1px solid var(--primary-color);
    border-radius: 12px;
    padding: 18px 24px;
    margin: 16px 0;
    position: relative;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    counter-reset: thinking-step;
    line-height: 1.7;
}

.thinking-process::before {
    content: "üí°";
    position: absolute;
    top: -18px;
    left: 20px;
    background: var(--light-card);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 1.2em;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.thinking-process strong {
    display: block;
    margin-bottom: 12px;
    font-style: normal;
    color: var(--primary-color);
    font-size: 1.1em;
    padding-bottom: 8px;
    border-bottom: 2px dashed rgba(123,104,238,0.3);
}

.thinking-process ol {
    padding-left: 32px;
    margin: 12px 0;
}

.thinking-process li {
    margin-bottom: 12px;
    position: relative;
    padding-left: 28px;
    transition: all 0.3s ease;
}

.thinking-process li::before {
    content: counter(thinking-step);
    counter-increment: thinking-step;
    position: absolute;
    left: 0;
    top: 2px;
    width: 20px;
    height: 20px;
    background: rgba(123,104,238,0.1);
    border-radius: 50%;
    text-align: center;
    line-height: 20px;
    font-size: 0.9em;
    color: var(--primary-color);
    font-weight: 600;
}

.thinking-process li:hover {
    transform: translateX(8px);
}

body.dark-mode .thinking-process {
    background: linear-gradient(145deg, rgba(123,104,238,0.15) 0%, rgba(123,104,238,0.05) 100%);
    border-color: rgba(123,104,238,0.5);
}

body.dark-mode .thinking-process::before {
    background: var(--dark-card);
    color: #7b68ee;
}
        :root {
            --primary-color: #7b68ee;
            --secondary-color: #5d4aee;
            --light-bg: #f5f7fb;
            --dark-bg: #1a1a2e;
            --light-sidebar: #eef1f8;
            --dark-sidebar: #242438;
            --light-text: #333;
            --dark-text: #e0e0e0;
            --light-card: #fff;
            --dark-card: #2a2a42;
            --light-border: #e0e0e0;
            --dark-border: #3f3f5a;
        }

        ‚ñ™ {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--light-text);
            transition: background-color 0.3s, color 0.3s;
            overflow: hidden;
            height: 100vh;
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* ‰æßËæπÊ†èÊ†∑Âºè */
        .sidebar {
            width: 280px;
            background-color: var(--light-sidebar);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--light-border);
            transition: all 0.3s, width 0.3s;
            position: relative;
            z-index: 10;
        }

        body.dark-mode .sidebar {
            background-color: var(--dark-sidebar);
            border-right: 1px solid var(--dark-border);
        }

        .sidebar-resizer {
            position: absolute;
            right: -5px;
            top: 0;
            width: 10px;
            height: 100%;
            cursor: col-resize;
            z-index: 11;
        }

        .new-chat-btn {
            margin: 15px;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }

        .new-chat-btn:hover {
            background-color: var(--secondary-color);
        }

        .new-chat-btn i {
            margin-right: 8px;
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .history-item {
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .history-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .history-item.active {
            background-color: rgba(123, 104, 238, 0.1);
        }

        .sidebar-footer {
            padding: 15px;
            border-top: 1px solid var(--light-border);
        }

        body.dark-mode .sidebar-footer {
            border-top: 1px solid var(--dark-border);
        }

        .settings-btn {
            padding: 10px;
            width: 100%;
            background: none;
            border: 1px solid var(--light-border);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            color: inherit;
            transition: background-color 0.2s;
        }

        body.dark-mode .settings-btn {
            border: 1px solid var(--dark-border);
        }

        .settings-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .settings-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .settings-btn i {
            margin-right: 8px;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫Âüü */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            border-bottom: 1px solid var(--light-border);
            background-color: var(--light-card);
        }

        body.dark-mode .header {
            background-color: var(--dark-card);
            border-bottom: 1px solid var(--dark-border);
        }

        .credits {
            display: flex;
            align-items: center;
            font-weight: 600;
        }

        .credits i {
            margin-right: 8px;
            color: #ffc107;
        }

        .add-credits-btn {
            margin-left: 10px;
            background: none;
            border: none;
            color: #ffc107;
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.2s;
        }

        .add-credits-btn:hover {
            transform: scale(1.2);
        }

        /* ÊÄùËÄÉËøáÁ®ãÂèØËßÜÂåñ */
        .thinking-process {
            background-color: var(--light-card);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid var(--primary-color);
            font-style: italic;
            color: #666;
        }

        body.dark-mode .thinking-process {
            background-color: var(--dark-card);
            color: #aaa;
        }

        /* ËÅäÂ§©Âå∫Âüü */
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .chat-intro {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 40px auto;
            max-width: 600px;
            text-align: center;
        }

        .chat-intro h1 {
            margin-bottom: 15px;
            font-size: 2rem;
        }

        .chat-intro p {
            color: #666;
            margin-bottom: 25px;
        }

        body.dark-mode .chat-intro p {
            color: #aaa;
        }

        .example-questions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
        }

        .example-item {
            padding: 15px;
            background-color: var(--light-card);
            border-radius: 8px;
            border: 1px solid var(--light-border);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .example-item {
            background-color: var(--dark-card);
            border: 1px solid var(--dark-border);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .example-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .example-item:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .message {
            max-width: 80%;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        .message.user-message {
            align-self: flex-end;
        }

        .message.ai-message {
            align-self: flex-start;
        }

        

        .user-message .message-content {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 10px;
        }

        .ai-message .message-content {
            background-color: var(--light-card);
            border-radius: 10px 10px 10px 0;
        }

        body.dark-mode .ai-message .message-content {
            background-color: var(--dark-card);
        }

        .message-time {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
            align-self: flex-end;
        }

        .ai-message .message-time {
            align-self: flex-start;
        }

        body.dark-mode .message-time {
            color: #aaa;
        }

        /* ‰ª£Á†ÅÂùóÊ†∑Âºè */
        .code-block {
    background: var(--dark-bg);
    border-radius: 8px;
    margin: 15px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.code-header {
    background: rgba(255,255,255,0.1);
    padding: 8px 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.code-content {
    padding: 12px;
    font-family: 'Fira Code', monospace;
    font-size: 0.9em;
    line-height: 1.5;
    tab-size: 4;
}

        body.dark-mode .code-block {
            background-color: #2d2d3a;
        }

        body.dark-mode .code-header {
            background-color: #35354a;
        }

        /* Ë°®Ê†ºÊ†∑Âºè */
        .table-container {
            margin: 10px 0;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            border: 1px solid var(--light-border);
            padding: 8px 12px;
            text-align: left;
        }

        body.dark-mode th, body.dark-mode td {
            border: 1px solid var(--dark-border);
        }

        th {
            background-color: #f0f0f0;
            font-weight: 600;
        }

        body.dark-mode th {
            background-color: #3a3a55;
        }

        /* ËÅäÂ§©ËæìÂÖ•Âå∫Âüü */
        .chat-input-container {
            padding: 15px 20px;
            background-color: var(--light-card);
            border-top: 1px solid var(--light-border);
        }

        body.dark-mode .chat-input-container {
            background-color: var(--dark-card);
            border-top: 1px solid var(--dark-border);
        }

        .chat-input-wrapper {
            display: flex;
            position: relative;
        }

        .chat-input {
            flex: 1;
            padding: 15px;
            padding-right: 100px;
            border-radius: 10px;
            border: 1px solid var(--light-border);
            outline: none;
            resize: none;
            min-height: 60px;
            max-height: 200px;
            background-color: var(--light-bg);
            transition: border-color 0.3s;
            overflow-y: auto;
        }

        body.dark-mode .chat-input {
            background-color: var(--dark-bg);
            border: 1px solid var(--dark-border);
            color: var(--dark-text);
        }

        .chat-input:focus {
            border-color: var(--primary-color);
        }

        .input-buttons {
            position: absolute;
            right: 10px;
            bottom: 10px;
            display: flex;
            gap: 8px;
        }

        .input-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            cursor: pointer;
            color: #777;
            transition: color 0.2s, background-color 0.2s;
        }

        .input-button:hover {
            color: var(--primary-color);
            background-color: rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .input-button:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .input-button.active {
            color: var(--primary-color);
        }

        .send-button {
            background-color: var(--primary-color);
            color: white;
        }

        .send-button:hover {
            background-color: var(--secondary-color);
            color: white;
        }

        .loading-dots {
            display: inline-flex;
            align-items: center;
        }

        .dot {
            width: 8px;
            height: 8px;
            background-color: currentColor;
            border-radius: 50%;
            margin: 0 2px;
            animation: dot-pulse 1.5s infinite ease-in-out;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes dot-pulse {
            0%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        /* ËÆæÁΩÆÂºπÁ™ó */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            width: 500px;
            background-color: var(--light-card);
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-20px);
            transition: transform 0.3s;
            overflow: hidden;
        }

        body.dark-mode .modal {
            background-color: var(--dark-card);
        }

        .modal-overlay.show .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        body.dark-mode .modal-header {
            border-bottom: 1px solid var(--dark-border);
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: inherit;
        }

        .modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .settings-section {
            margin-bottom: 25px;
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .settings-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-status {
            display: inline-block;
            padding: 3px 8px;
            background-color: #4caf50;
            color: white;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .privacy-link {
            color: var(--primary-color);
            text-decoration: none;
        }

        .privacy-link:hover {
            text-decoration: underline;
        }

        /* ÁßØÂàÜÂÖëÊç¢ÂºπÁ™ó */
        .credits-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .credits-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .credits-modal {
            width: 400px;
            background-color: var(--light-card);
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-20px);
            transition: transform 0.3s;
            overflow: hidden;
        }

        body.dark-mode .credits-modal {
            background-color: var(--dark-card);
        }

        .credits-modal-overlay.show .credits-modal {
            transform: translateY(0);
        }

        .credits-modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        body.dark-mode .credits-modal-header {
            border-bottom: 1px solid var(--dark-border);
        }

        .credits-modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close-credits-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: inherit;
        }

        .credits-modal-body {
            padding: 20px;
        }

        .redeem-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .redeem-input {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--light-border);
            background-color: var(--light-bg);
            font-size: 1rem;
        }

        body.dark-mode .redeem-input {
            background-color: var(--dark-bg);
            border: 1px solid var(--dark-border);
            color: var(--dark-text);
        }

        .redeem-button {
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .redeem-button:hover {
            background-color: var(--secondary-color);
        }

        .redeem-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                height: 100%;
            }

            .sidebar.show {
                left: 0;
            }

            .sidebar-toggle {
                display: block;
            }

            .example-questions {
                grid-template-columns: 1fr;
            }
        }
        .model-selection-container {
  display: flex;
  gap: 10px;
  margin-bottom: 8px;
}

.model-option {
  cursor: pointer;
  padding: 8px 16px;
  border: 2px solid var(--light-border);
  border-radius: 8px;
  transition: background-color 0.2s, border-color 0.2s;
}

.model-option:hover {
  border-color: var(--primary-color);
}

.model-option.active {
  background-color: var(--primary-color);
  color: #fff;
  border-color: var(--primary-color);
}
.chat-input-tips {
  font-size: 0.8rem;
  color: #888;
  text-align: center;
  margin-top: 5px;
}
.featured-sections {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
    margin-top: 20px;
}

.section-container {
    background-color: var(--light-card);
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    overflow: hidden;
    transition: transform 0.3s, box-shadow 0.3s;
}

body.dark-mode .section-container {
    background-color: var(--dark-card);
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
}

.section-header {
    padding: 15px 20px;
    background: linear-gradient(135deg, rgba(123,104,238,0.1) 0%, rgba(123,104,238,0.05) 100%);
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-header i {
    color: var(--primary-color);
    font-size: 1.2rem;
}

.section-header h2 {
    font-size: 1.2rem;
    margin: 0;
    color: var(--light-text);
    font-weight: 600;
}

body.dark-mode .section-header h2 {
    color: var(--dark-text);
}

/* Hot searches styling */
.search-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    padding: 15px;
}

.search-item {
    background-color: rgba(123,104,238,0.05);
    border: 1px solid rgba(123,104,238,0.1);
    border-radius: 8px;
    padding: 12px 15px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
}

.search-item:hover {
    background-color: rgba(123,104,238,0.1);
    transform: translateY(-2px);
}

.search-item span {
    font-size: 0.9rem;
    color: var(--light-text);
    font-weight: 500;
}

body.dark-mode .search-item span {
    color: var(--dark-text);
}

/* Try asking me styling */
.ask-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 15px;
}

.ask-item {
    display: flex;
    align-items: center;
    background-color: rgba(123,104,238,0.05);
    border: 1px solid rgba(123,104,238,0.1);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.2s;
}

.ask-item:hover {
    background-color: rgba(123,104,238,0.1);
    transform: translateY(-2px);
}

.ask-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    flex-shrink: 0;
}

.ask-icon i {
    color: white;
    font-size: 1rem;
}

.ask-content {
    flex: 1;
}

.ask-content h3 {
    font-size: 0.95rem;
    margin: 0 0 5px 0;
    color: var(--primary-color);
    font-weight: 600;
}

.ask-content p {
    font-size: 0.85rem;
    margin: 0;
    color: var(--light-text);
}

body.dark-mode .ask-content p {
    color: var(--dark-text);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .search-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .ask-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .search-grid {
        grid-template-columns: 1fr;
    }
}
/* Âú®ÂéüÊúâÊ†∑Âºè‰∏≠Ê∑ªÂä† */
.message-actions {
    display: flex;
    gap: 8px;
    margin-top: 8px;
    opacity: 0;
    transition: opacity 0.2s;
}

.message:hover .message-actions {
    opacity: 1;
}

.action-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--light-text);
    padding: 4px;
    font-size: 0.9em;
    transition: color 0.2s;
}

.action-btn:hover {
    color: var(--primary-color);
}

body.dark-mode .action-btn {
    color: var(--dark-text);
}

.liked {
    color: #4CAF50 !important;
}

.disliked {
    color: #F44336 !important;
}
.search-status {
    display: none;
    align-items: center;
    gap: 8px;
    color: var(--primary-color);
    font-size: 0.9rem;
    padding: 8px 12px;
    background: rgba(123,104,238,0.1);
    border-radius: 8px;
    margin-bottom: 10px;
}

.search-status.active {
    display: flex;
}
    </style>
</head>
<body>
    <div class="container">
        <!-- ‰æßËæπÊ†è -->
        <div class="sidebar">
            <div class="sidebar-resizer"></div>
            <button class="new-chat-btn"><i class="fas fa-plus"></i> Êñ∞Âª∫ËÅäÂ§©</button>
            <div class="chat-history">
                <!-- ËÅäÂ§©ÂéÜÂè≤Â∞ÜÂú®ËøôÈáåÂä®ÊÄÅÂä†ËΩΩ -->
            </div>
            <div class="sidebar-footer">
                <button class="settings-btn"><i class="fas fa-cog"></i> ËÆæÁΩÆ</button>
            </div>
            <div class="sidebar-header">
                <button class="toggle-sidebar-btn"><i class="fas fa-chevron-left"></i></button>
            </div>
            
            <style>
                .sidebar-header {
                    padding: 10px;
                    border-bottom: 1px solid var(--light-border);
                    display: flex;
                    justify-content: flex-end;
                }
            
                .toggle-sidebar-btn {
                    background: none;
                    border: none;
                    color: var(--primary-color);
                    cursor: pointer;
                    padding: 5px;
                }
            
                @media (min-width: 769px) {
                    .sidebar.collapsed {
                        width: 50px !important;
                        overflow: hidden;
                    }
            
                    .sidebar.collapsed .toggle-sidebar-btn i {
                        transform: rotate(180deg);
                    }
            
                    .sidebar.collapsed .new-chat-btn,
                    .sidebar.collapsed .chat-history,
                    .sidebar.collapsed .settings-btn span {
                        display: none;
                    }
                }
            </style>
        </div>

        <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
        <div class="main-content">
            <div class="header">
                <!-- Ê®°ÂûãÈÄâÊã©ÊîæÁΩÆÂú®ÊúÄÂ∑¶Ëæπ -->
                <div class="left-header">
                  <select class="model-select" id="modelSelect">
                    <option value="Jork-3-Epic" data-cost="100">Jork-3-Epic (100ÁßØÂàÜ)</option>
                    <option value="Jork-3-Canto" data-cost="60">Jork-3-Canto (60ÁßØÂàÜ)</option>
                    <option value="Jork-3-Tanka" data-cost="30">Jork-3-Tanka (30ÁßØÂàÜ)</option>
                    <option value="Claude-3.5-Sonnet" data-cost="300">Claude-3.5-Sonnet (300ÁßØÂàÜ)</option>
                    <option value="Claude-3.7-Sonnet" data-cost="800">Claude-3.7-Sonnet (800ÁßØÂàÜ)</option>
                  </select>
                </div>
                <!-- ÁßØÂàÜÊòæÁ§∫ÊîæÂú®Âè≥Ëæπ -->
                <div class="credits">
                  <i class="fas fa-coins"></i>
                  <span>ÁßØÂàÜÔºö3000</span>
                  <button class="add-credits-btn" title="Ê∑ªÂä†ÁßØÂàÜ"><i class="fas fa-plus-circle"></i></button>
                </div>
            </div>
            <!-- ËÅäÂ§©Âå∫Âüü -->
            <div class="chat-area">
                <!-- Replace the existing chat-intro div with this new structure -->
<div class="chat-intro">
    <h1>‰∏ãÂçàÂ•ΩÔºåÊàëÊòØ JorkAI</h1>
    <p>Êúâ‰ªÄ‰πàÂèØ‰ª•Â∏ÆÂä©‰Ω†ÁöÑÂêóÔºü</p>
    
    <div class="featured-sections">
        <!-- Hot searches section -->
        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-fire"></i>
                <h2>ÁÉ≠Êêú</h2>
            </div>
            <div class="search-grid">
                <div class="search-item" data-query="ChatGPTÂíåClaudeÊúâ‰ªÄ‰πàÂå∫Âà´Ôºü">
                    <span>ChatGPTÂíåClaudeÊúâ‰ªÄ‰πàÂå∫Âà´Ôºü</span>
                </div>
                <div class="search-item" data-query="Â¶Ç‰ΩïÊèêÈ´òËã±ËØ≠Âè£ËØ≠Ê∞¥Âπ≥Ôºü">
                    <span>Â¶Ç‰ΩïÊèêÈ´òËã±ËØ≠Âè£ËØ≠Ê∞¥Âπ≥Ôºü</span>
                </div>
                <div class="search-item" data-query="PythonÂíåJavaScriptÂì™‰∏™Êõ¥ÈÄÇÂêàÂàùÂ≠¶ËÄÖÔºü">
                    <span>PythonÂíåJavaScriptÂì™‰∏™Êõ¥ÈÄÇÂêàÂàùÂ≠¶ËÄÖÔºü</span>
                </div>
                <div class="search-item" data-query="‰∫∫Â∑•Êô∫ËÉΩ‰ºöÂèñ‰ª£Âì™‰∫õÂ∑•‰ΩúÔºü">
                    <span>‰∫∫Â∑•Êô∫ËÉΩ‰ºöÂèñ‰ª£Âì™‰∫õÂ∑•‰ΩúÔºü</span>
                </div>
                <div class="search-item" data-query="Â¶Ç‰ΩïÊúâÊïàÁÆ°ÁêÜÊó∂Èó¥Ôºü">
                    <span>Â¶Ç‰ΩïÊúâÊïàÁÆ°ÁêÜÊó∂Èó¥Ôºü</span>
                </div>
                <div class="search-item" data-query="ÊùéÂòâËØöÂçñÊéâ43‰∏™Ê∏ØÂè£ÂØπ‰∏≠ÂõΩÁöÑÂΩ±Âìç">
                    <span>ÊùéÂòâËØöÂçñÊéâ43‰∏™Ê∏ØÂè£</span>
                </div>
            </div>
        </div>
        
        <!-- Try asking me section -->
        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-question-circle"></i>
                <h2>ËØïÁùÄÈóÆÊàë</h2>
            </div>
            <div class="ask-grid">
                <div class="ask-item" data-query="Â∏ÆÊàëÂÜô‰∏ÄÁØáÂÖ≥‰∫éÁéØ‰øùÁöÑÊºîËÆ≤Á®ø">
                    <div class="ask-icon"><i class="fas fa-pencil-alt"></i></div>
                    <div class="ask-content">
                        <h3>ÂÜô‰ΩúÂä©Êâã</h3>
                        <p>Â∏ÆÊàëÂÜô‰∏ÄÁØáÂÖ≥‰∫éÁéØ‰øùÁöÑÊºîËÆ≤Á®ø</p>
                    </div>
                </div>
                <div class="ask-item" data-query="Ëß£Èáä‰∏Ä‰∏ãÂå∫ÂùóÈìæÊäÄÊúØÁöÑÂ∑•‰ΩúÂéüÁêÜ">
                    <div class="ask-icon"><i class="fas fa-lightbulb"></i></div>
                    <div class="ask-content">
                        <h3>Áü•ËØÜËß£Á≠î</h3>
                        <p>Ëß£Èáä‰∏Ä‰∏ãÂå∫ÂùóÈìæÊäÄÊúØÁöÑÂ∑•‰ΩúÂéüÁêÜ</p>
                    </div>
                </div>
                <div class="ask-item" data-query="ËÆæËÆ°‰∏Ä‰∏™PythonÁà¨Ëô´Ëé∑ÂèñÊñ∞ÈóªÊ†áÈ¢ò">
                    <div class="ask-icon"><i class="fas fa-code"></i></div>
                    <div class="ask-content">
                        <h3>ÁºñÁ®ãÂ∏ÆÂä©</h3>
                        <p>ËÆæËÆ°‰∏Ä‰∏™PythonÁà¨Ëô´Ëé∑ÂèñÊñ∞ÈóªÊ†áÈ¢ò</p>
                    </div>
                </div>
                <div class="ask-item" data-query="Â¶Ç‰ΩïÂú®‰∏ÄÂë®ÂÜÖÂ≠¶‰ºöÂü∫Á°ÄÁëú‰ºΩÂä®‰ΩúÔºü">
                    <div class="ask-icon"><i class="fas fa-dumbbell"></i></div>
                    <div class="ask-content">
                        <h3>ÂÅ•Â∫∑ÁîüÊ¥ª</h3>
                        <p>Â¶Ç‰ΩïÂú®‰∏ÄÂë®ÂÜÖÂ≠¶‰ºöÂü∫Á°ÄÁëú‰ºΩÂä®‰ΩúÔºü</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add these styles to your existing CSS -->
                <!-- ËÅäÂ§©Ê∂àÊÅØÂ∞ÜÂú®ËøôÈáåÂä®ÊÄÅÂä†ËΩΩ -->
            </div>
              

<!-- ‰øÆÊîπÂêéÁöÑËÅäÂ§©ËæìÂÖ•Âå∫Âüü -->
<div class="chat-input-container">
    <div class="search-status">
        <i class="fas fa-search"></i>
        <span>ËÅîÁΩëÊêúÁ¥¢Ê®°ÂºèÂ∑≤ÊøÄÊ¥ª</span>
    </div>
  
    <!-- ËæìÂÖ•Ê°ÜÂíåÊåâÈíÆÈÉ®ÂàÜ‰øùÊåÅ‰∏çÂèò -->
    <div class="chat-input-wrapper">
      <textarea class="chat-input" placeholder="ËæìÂÖ•Ê∂àÊÅØ..." rows="1"></textarea>
      <div class="input-buttons">
        <button class="input-button thinking-button" title="Ê∑±Â∫¶ÊÄùËÄÉ">
          <i class="fas fa-lightbulb"></i>
        </button>
        <button class="input-button search-button" title="ËÅîÁΩëÊêúÁ¥¢">
          <i class="fas fa-search"></i>
        </button>
        <button class="input-button upload-button" title="‰∏ä‰º†ÈôÑ‰ª∂">
          <i class="fas fa-paperclip"></i>
        </button>
        <button class="input-button voice-button" title="ËØ≠Èü≥ËæìÂÖ•">
            <i class="fas fa-microphone"></i>
        </button>

        <button class="input-button send-button" title="ÂèëÈÄÅ">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
      <!-- Ê∑ªÂä†ËØ≠Èü≥Áä∂ÊÄÅÊèêÁ§∫ -->
<div class="voice-status">
    <i class="fas fa-microphone"></i>
    <span>Ê≠£Âú®ËÅÜÂê¨...</span>
</div>
    </div>
  </div>
  
  <style>
  /* Êñ∞Â¢ûÊ†∑Âºè */
  .chat-input-container {
    display: flex;
    align-items: center; /* ÂûÇÁõ¥Â±Ö‰∏≠ */
    gap: 10px; /* ÂÖÉÁ¥†‰πãÈó¥ÁöÑÈó¥Ë∑ù */
  }
  
  .model-selection {
    flex-shrink: 0; /* Èò≤Ê≠¢ÈÄâÊã©Ê°ÜË¢´ÂéãÁº© */
  }
  
  .chat-input-wrapper {
    flex: 1; /* ËæìÂÖ•Ê°ÜÂç†ÊçÆÂâ©‰ΩôÁ©∫Èó¥ */
  }
  
  /* Ë∞ÉÊï¥ÈÄâÊã©Ê°ÜÊ†∑Âºè */
  .model-select {
    width: 150px; /* Ë∞ÉÊï¥ÂÆΩÂ∫¶ */
    padding: 6px 10px; /* Ë∞ÉÊï¥ÂÜÖËæπË∑ù */
    border: 2px solid var(--light-border);
    border-radius: 8px;
    background-color: var(--light-bg);
    color: var(--light-text);
    font-size: 0.85em; /* Ë∞ÉÊï¥Â≠ó‰ΩìÂ§ßÂ∞è */
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%237b68ee' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 8px center; /* Ë∞ÉÊï¥ÁÆ≠Â§¥‰ΩçÁΩÆ */
    background-size: 14px; /* Ë∞ÉÊï¥ÁÆ≠Â§¥Â§ßÂ∞è */
    transition: border-color 0.3s;
  }
  
  body.dark-mode .model-select {
    background-color: var(--dark-bg);
    border-color: var(--dark-border);
    color: var(--dark-text);
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23aaa' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
  }
  
  .model-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(123, 104, 238, 0.2);
  }
  
  /* Ë∞ÉÊï¥ÊèêÁ§∫‰ø°ÊÅØÊ†∑Âºè */
  .chat-input-tips {
    width: 100%;
    text-align: center;
    margin-top: 5px;
    font-size: 0.8rem;
    color: #888;
  }
  </style>

    <!-- ËÆæÁΩÆÂºπÁ™ó -->
    <div class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">ËÆæÁΩÆ</h3>
                <button class="close-modal">&times;</button>
            </div>
            <!-- Êñ∞Â¢ûÈìæÊé•Âå∫Âùó -->
        
            <div class="modal-body">
                <div class="settings-section">
                    <h4 class="settings-title">Ë¥¶Êà∑‰ø°ÊÅØ</h4>
                    <div class="settings-content">
                        <div class="user-info">
                            <div class="user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="user-details">
                                <div class="user-name">Áî®Êà∑001</div>
                                <div class="user-status">‰ºöÂëò</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h4 class="settings-title">ÁïåÈù¢ËÆæÁΩÆ</h4>
                    <div class="settings-content">
                        <div class="switch-container">
                            <span>Ê∑±Ëâ≤Ê®°Âºè</span>
                            <label class="switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Add this new section to the modal-body in your settings modal -->
<div class="settings-section">
    <h4 class="settings-title">API Êé•ÂÖ•ËÆæÁΩÆ</h4>
    <div class="settings-content">
        <div class="api-input-container">
            <label for="apiKeyInput">API Key</label>
            <div class="api-input-wrapper">
                <input type="password" id="apiKeyInput" class="api-input" placeholder="ËØ∑ËæìÂÖ•ÊÇ®ÁöÑAPIÂØÜÈí•">
                <button id="toggleApiKey" class="toggle-api-key">
                    <i class="far fa-eye"></i>
                </button>
            </div>
        </div>
        <div class="api-input-container">
            <label for="apiEndpointInput">API Á´ØÁÇπ</label>
            <input type="text" id="apiEndpointInput" class="api-input" placeholder="https://api.example.com/v1/chat/completions">
        </div>
        <div class="api-provider-dropdown">
            <label for="apiProviderSelect">API Êèê‰æõÂïÜ</label>
            <select id="apiProviderSelect" class="api-select">
                <option value="custom">Ëá™ÂÆö‰πâ</option>
                <option value="openai">OpenAI</option>
                <option value="anthropic">Anthropic</option>
                <option value="deepseek">DeepSeek</option>
                <option value="qianfan">ÁôæÂ∫¶ÂçÉÂ∏Ü</option>
                <option value="xinghuo">ÊòüÁÅ´ËÆ§Áü•</option>
            </select>
        </div>
        <div class="api-actions">
            <button id="saveApiSettings" class="api-save-btn">‰øùÂ≠òËÆæÁΩÆ</button>
            <button id="testApiConnection" class="api-test-btn">ÊµãËØïËøûÊé•</button>
        </div>
        <div id="apiStatus" class="api-status"></div>
    </div>
</div>

<!-- Add these styles to your existing CSS -->
<style>
.api-input-container {
    margin-bottom: 15px;
}

.api-input-container label {
    display: block;
    margin-bottom: 6px;
    font-size: 0.9rem;
    color: var(--light-text);
}

body.dark-mode .api-input-container label {
    color: var(--dark-text);
}

.api-input {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid var(--light-border);
    background-color: var(--light-bg);
    font-size: 0.9rem;
    transition: border-color 0.2s, box-shadow 0.2s;
}

body.dark-mode .api-input {
    background-color: var(--dark-bg);
    border-color: var(--dark-border);
    color: var(--dark-text);
}

.api-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(123, 104, 238, 0.2);
}

.api-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.toggle-api-key {
    position: absolute;
    right: 10px;
    background: none;
    border: none;
    color: #888;
    cursor: pointer;
    padding: 5px;
    font-size: 1rem;
    transition: color 0.2s;
}

.toggle-api-key:hover {
    color: var(--primary-color);
}

.api-provider-dropdown {
    margin-bottom: 15px;
}

.api-select {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid var(--light-border);
    background-color: var(--light-bg);
    font-size: 0.9rem;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%237b68ee' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 14px;
}

body.dark-mode .api-select {
    background-color: var(--dark-bg);
    border-color: var(--dark-border);
    color: var(--dark-text);
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23aaa' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
}

.api-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(123, 104, 238, 0.2);
}

.api-actions {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.api-save-btn, .api-test-btn {
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
}

.api-save-btn {
    background-color: var(--primary-color);
    color: white;
    border: none;
    flex: 1;
}

.api-save-btn:hover {
    background-color: var(--secondary-color);
}

.api-test-btn {
    background-color: transparent;
    color: var(--primary-color);
    border: 1px solid var(--primary-color);
}

body.dark-mode .api-test-btn {
    color: var(--primary-color);
}

.api-test-btn:hover {
    background-color: rgba(123, 104, 238, 0.1);
}

.api-status {
    font-size: 0.9rem;
    padding: 8px 0;
    text-align: center;
    display: none;
}

.api-status.success {
    color: #4CAF50;
    display: block;
}

.api-status.error {
    color: #F44336;
    display: block;
}
</style>

                <div class="settings-section">
                    <h4 class="settings-title">ÈöêÁßÅ‰∏éÂçèËÆÆ</h4>
                    <div class="settings-content">
                        <a href="yinsi.html" class="privacy-link">ÈöêÁßÅÂçèËÆÆ</a>
                        <a href="juanqian.html" class="privacy-link">ÊîØÊåÅÊàë‰ª¨</a>
                        <a href="shuomingshu.html" class="privacy-link">Â¶Ç‰Ωï‰ΩøÁî®</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ÁßØÂàÜÂÖëÊç¢ÂºπÁ™ó -->
    <div class="credits-modal-overlay">
        <div class="credits-modal">
            <div class="credits-modal-header">
                <h3 class="credits-modal-title">ÁßØÂàÜÂÖëÊç¢</h3>
                <button class="close-credits-modal">&times;</button>
            </div>
            <div class="credits-modal-body">
                <div class="redeem-form">
                    <input type="text" class="redeem-input" placeholder="ËØ∑ËæìÂÖ•ÂÖëÊç¢Á†Å" id="redeemCode">
                    <button class="redeem-button" id="redeemButton">ÂÖëÊç¢ÁßØÂàÜ</button>
                    <div id="redeemMessage" style="color: green; text-align: center; display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Êñá‰ª∂‰∏ä‰º†ÈöêËóèËæìÂÖ• -->
    <input type="file" id="file-upload" style="display: none">

    <script>
        // Ëé∑ÂèñDOMÂÖÉÁ¥†
        const modelSelect = document.getElementById('modelSelect'); // Ëé∑Âèñ‰∏ãÊãâËèúÂçï
        const sidebar = document.querySelector('.sidebar');
        const sidebarResizer = document.querySelector('.sidebar-resizer');
        const newChatBtn = document.querySelector('.new-chat-btn');
        const chatArea = document.querySelector('.chat-area');
        const chatInput = document.querySelector('.chat-input');
        const sendButton = document.querySelector('.send-button');
        const thinkingButton = document.querySelector('.thinking-button');
        const searchButton = document.querySelector('.search-button');
        const uploadButton = document.querySelector('.upload-button');
        const fileUpload = document.getElementById('file-upload');
        const settingsBtn = document.querySelector('.settings-btn');
        const modalOverlay = document.querySelector('.modal-overlay');
        const closeModal = document.querySelector('.close-modal');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const exampleItems = document.querySelectorAll('.example-item');
        const creditDisplay = document.querySelector('.credits span');
        const addCreditsBtn = document.querySelector('.add-credits-btn');
        const creditsModalOverlay = document.querySelector('.credits-modal-overlay');
        const closeCreditsModal = document.querySelector('.close-credits-modal');
        const redeemButton = document.getElementById('redeemButton');
        const redeemCode = document.getElementById('redeemCode');
        const redeemMessage = document.getElementById('redeemMessage');
        
        // Áä∂ÊÄÅÂèòÈáè
        let isThinking = false;
        let isSearching = false;
        let currentCredits = localStorage.getItem('jorkCredits') 
                     ? parseInt(localStorage.getItem('jorkCredits')) 
                     : 3000; // ÈªòËÆ§ÁßØÂàÜ
        let chatHistory = [];
        let currentChatId = null;
        let isTyping = false;
        let hasRedeemedCode = localStorage.getItem('hasRedeemedCode') === 'true';


            // Âú®JavaScriptÈÉ®ÂàÜÊ∑ªÂä†
            const toggleSidebarBtn = document.querySelector('.toggle-sidebar-btn');
            toggleSidebarBtn.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
            });

        // ËØ≠Èü≥ËØÜÂà´ÈÄªËæë
let recognition;
if ('webkitSpeechRecognition' in window) {
    recognition = new webkitSpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = true;

    document.querySelector('.voice-button').addEventListener('click', () => {
        recognition.start();
        document.querySelector('.voice-status').style.display = 'flex';
    });

    recognition.onresult = (e) => {
        const transcript = Array.from(e.results)
            .map(result => result[0].transcript)
            .join('');
        chatInput.value = transcript;
    };

    recognition.onerror = () => {
        document.querySelector('.voice-status').style.display = 'none';
    };
} else {
    document.querySelector('.voice-button').style.display = 'none';
}

// ÁõëÂê¨ËæìÂÖ•‰∫ã‰ª∂
chatInput.addEventListener('keyup', (e) => {
    if (e.key === '/') {
        showCommandPalette();
    }
});

// ÂëΩ‰ª§Èù¢Êùø
function showCommandPalette() {
    const commands = [
        {icon: 'fa-language', name: 'ÁøªËØë', prompt: 'Â∞Ü‰ª•‰∏ãÂÜÖÂÆπÁøªËØëÊàêËã±ÊñáÔºö'},
        {icon: 'fa-code', name: '‰ºòÂåñ‰ª£Á†Å', prompt: '‰ºòÂåñËøôÊÆµ‰ª£Á†ÅÁöÑÂèØËØªÊÄßÔºö'},
        {icon: 'fa-file-alt', name: 'ÊÄªÁªì', prompt: 'Áî®‰∏âÁÇπÊÄªÁªì‰ª•‰∏ãÂÜÖÂÆπÔºö'}
    ];

    const palette = `<div class="command-palette">
        ${commands.map(cmd => `
            <div class="command-item" data-prompt="${cmd.prompt}">
                <i class="fas ${cmd.icon}"></i>${cmd.name}
            </div>
        `).join('')}
    </div>`;

    // ÊèíÂÖ•Âà∞ËæìÂÖ•Ê°Ü‰∏ãÊñπÂπ∂Â§ÑÁêÜÁÇπÂáª
    document.body.insertAdjacentHTML('beforeend', palette);
    document.querySelectorAll('.command-item').forEach(item => {
        item.addEventListener('click', () => {
            chatInput.value = item.dataset.prompt;
            document.querySelector('.command-palette').remove();
        });
    });
}

            function saveCreditsToStorage() {
    try {
        localStorage.setItem('jorkCredits', currentCredits.toString());
    } catch (e) {
        console.error('ÁßØÂàÜÂ≠òÂÇ®Â§±Ë¥•:', e);
        // Â§ÑÁêÜÂ≠òÂÇ®Á©∫Èó¥‰∏çË∂≥ÁöÑÊÉÖÂÜµ
        if (e.name === 'QuotaExceededError') {
            alert('Êú¨Âú∞Â≠òÂÇ®Á©∫Èó¥‰∏çË∂≥ÔºåÁßØÂàÜÂ∞ÜÊöÇÊó∂‰øùÂ≠òÂú®ÂÜÖÂ≠ò‰∏≠');
        }
    }
}

function initClickableItems() {
    // Set up click handlers for hot searches
    document.querySelectorAll('.search-item').forEach(item => {
        item.addEventListener('click', () => {
            const query = item.dataset.query;
            chatInput.value = query;
            sendMessage();
        });
    });
    
    // Set up click handlers for "try asking me" items
    document.querySelectorAll('.ask-item').forEach(item => {
        item.addEventListener('click', () => {
            const query = item.dataset.query;
            chatInput.value = query;
            sendMessage();
        });
    });
}

// ÁÉ≠ÊêúÁÇπÂáª‰∫ã‰ª∂
document.querySelectorAll('.search-item').forEach(item => {
    item.addEventListener('click', () => {
        const query = item.dataset.query;
        chatInput.value = query;
        sendMessage();
    });
});

// ÂõæÁâáÁîüÊàêÁÇπÂáª‰∫ã‰ª∂
document.querySelectorAll('.image-item').forEach(item => {
    item.addEventListener('click', () => {
        const prompt = item.dataset.prompt;
        chatInput.value = `/generate ${prompt}`;
        sendMessage();
    });
});

// Ê∑ªÂä†Ëøô‰∏™ÂáΩÊï∞ ‚Üì‚Üì‚Üì
function getSelectedModelCost() {
  const selectedOption = modelSelect.options[modelSelect.selectedIndex];
  return parseInt(selectedOption.dataset.cost);
}
            // ÂàùÂßãÂåñÂáΩÊï∞
        function init() {
            // Ê£ÄÊü•Êú¨Âú∞Â≠òÂÇ®‰∏≠ÁöÑÊ∑±Ëâ≤Ê®°ÂºèËÆæÁΩÆ
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
            }
            
            // Âä†ËΩΩËÅäÂ§©ÂéÜÂè≤
            loadChatHistory();
            
            // ÂàùÂßãÂåñÂΩìÂâçËÅäÂ§©
            currentChatId = 'chat_' + Date.now();
            chatHistory.push({
                id: currentChatId,
                title: 'Êñ∞ÁöÑËÅäÂ§©',
                messages: []
            });
            saveChatHistory();
            updateChatHistoryUI();
            
            // Ê†πÊçÆÊó∂Èó¥Ë∞ÉÊï¥ÈóÆÂÄôËØ≠
            updateGreeting();
            
            // Ëá™Âä®Ë∞ÉÊï¥ËæìÂÖ•Ê°ÜÈ´òÂ∫¶
            chatInput.addEventListener('input', autoResizeTextarea);
            
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÂÖëÊç¢ËøáÁßØÂàÜÁ†Å
            if (hasRedeemedCode) {
                redeemButton.disabled = true;
                redeemCode.disabled = true;
                redeemMessage.textContent = "ÊÇ®Â∑≤ÁªèÂÖëÊç¢ËøáÁßØÂàÜ";
                redeemMessage.style.color = "#888";
                redeemMessage.style.display = "block";
            }
        }

        // Êõ¥Êñ∞ÈóÆÂÄôËØ≠
        function updateGreeting() {
            const now = new Date();
            const hour = now.getHours();
            let greeting = '';
            
            if (hour < 6) {
                greeting = 'ÂáåÊô®Â•Ω';
            } else if (hour < 9) {
                greeting = 'Êó©‰∏äÂ•Ω';
            } else if (hour < 12) {
                greeting = '‰∏äÂçàÂ•Ω';
            } else if (hour < 14) {
                greeting = '‰∏≠ÂçàÂ•Ω';
            } else if (hour < 18) {
                greeting = '‰∏ãÂçàÂ•Ω';
            } else {
                greeting = 'Êôö‰∏äÂ•Ω';
            }
            
            const introTitle = document.querySelector('.chat-intro h1');
            if (introTitle) {
                introTitle.textContent = `${greeting}ÔºåÊàëÊòØ Jork-v3`;
            }
        }

        modelSelect.value = 'Canto'; 

        // Â§ÑÁêÜ‰æßËæπÊ†èË∞ÉÊï¥Â§ßÂ∞è
        let isResizing = false;
        let initialX = 0;
        let initialWidth = 0;

        sidebarResizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            initialX = e.clientX;
            initialWidth = sidebar.offsetWidth;
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', () => {
                isResizing = false;
                document.removeEventListener('mousemove', handleMouseMove);
            });
        });

        function handleMouseMove(e) {
            if (isResizing) {
                const newWidth = initialWidth + (e.clientX - initialX);
                if (newWidth >= 180 && newWidth <= 500) {
                    sidebar.style.width = newWidth + 'px';
                }
            }
        }

        // Â§ÑÁêÜËÅäÂ§©ËæìÂÖ•Ê°ÜËá™Âä®Ë∞ÉÊï¥È´òÂ∫¶
        function autoResizeTextarea() {
            chatInput.style.height = 'auto';
            chatInput.style.height = (chatInput.scrollHeight) + 'px';
        }

        // ÂèëÈÄÅÊ∂àÊÅØÂ§ÑÁêÜ
        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ÁªëÂÆöËá™ÂÆö‰πâÈÄâÊã©Ê°ÜÁöÑÁÇπÂáª‰∫ã‰ª∂
document.querySelectorAll('.model-option').forEach(item => {
  item.addEventListener('click', () => {
    // ÁßªÈô§ÊâÄÊúâÈÄâÈ°πÁöÑÊøÄÊ¥ªÁä∂ÊÄÅ
    document.querySelectorAll('.model-option').forEach(opt => opt.classList.remove('active'));
    // Â∞ÜÂΩìÂâçÁÇπÂáªÈ°πËÆæ‰∏∫ÊøÄÊ¥ªÁä∂ÊÄÅ
    item.classList.add('active');
  });
});

// Êñ∞Â¢ûDuckDuckGoÊêúÁ¥¢ÂáΩÊï∞
async function searchWeb(query) {
    try {
        const response = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_html=1&no_redirect=1`);
        const data = await response.json();
        return {
            abstract: data.AbstractText,
            results: data.RelatedTopics?.slice(0, 3).map(t => t.Text).filter(Boolean) || []
        };
    } catch (error) {
        console.error('ÊêúÁ¥¢Â§±Ë¥•:', error);
        return null;
    }
}

// ‰øÆÊîπÊêúÁ¥¢ÊåâÈíÆÁÇπÂáªÂ§ÑÁêÜ
searchButton.addEventListener('click', () => {
    isSearching = !isSearching;
    document.querySelector('.search-status').classList.toggle('active', isSearching);
    searchButton.classList.toggle('active', isSearching);
});



    // ‰øÆÊîπÂèëÈÄÅÊ∂àÊÅØÊó∂ÁßØÂàÜÊâ£Èô§ÈÄªËæëÔºàÁ§∫‰æã‰∏≠ÁöÑ sendMessage ÂáΩÊï∞‰∏≠‰ΩøÁî®Ôºâ
  async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;
    
    
    const cost = getSelectedModelCost();
    
    if (currentCredits < cost) {
      alert('ÁßØÂàÜ‰∏çË∂≥ÔºåËØ∑ÂÖÖÂÄºÂêéÁªßÁª≠‰ΩøÁî®„ÄÇ');
      return;
    }
    
    currentCredits -= cost;
    saveCreditsToStorage();
    updateCreditsDisplay();
    
    chatInput.value = '';
    chatInput.style.height = 'auto';
    
    const chatIntro = document.querySelector('.chat-intro');
    if (chatIntro) {
      chatIntro.style.display = 'none';
    }
    let searchContent = '';
    if (isSearching) {
        addMessage("üîç Ê≠£Âú®ËÅîÁΩëÊêúÁ¥¢ÊúÄÊñ∞‰ø°ÊÅØ...", 'system');
        const searchResult = await searchWeb(message);
        if (searchResult) {
            searchContent = `ÁΩëÁªúÊêúÁ¥¢ÁªìÊûúÔºö
${searchResult.abstract ? `ÊëòË¶ÅÔºö${searchResult.abstract}\n` : ''}
${searchResult.results.length > 0 ? `Áõ∏ÂÖ≥ÁªìÊûúÔºö\n${searchResult.results.map((r,i) => `${i+1}. ${r}`).join('\n')}` : ''}`;
            
            // ÊòæÁ§∫ÊêúÁ¥¢ËøáÁ®ã
            addMessage(`üåê ÊêúÁ¥¢ÂÆåÊàêÔºåÊâæÂà∞${searchResult.results.length}Êù°Áõ∏ÂÖ≥‰ø°ÊÅØ`, 'system');
        }
    }

    // ÊûÑÂª∫AIÊèêÁ§∫ËØç
    const aiPrompt = isSearching ? 
        `${searchContent}\n\nÂü∫‰∫é‰ª•‰∏äÂÆûÊó∂‰ø°ÊÅØÂõûÁ≠îÔºö${message}` : 
        message;
    
    addMessage(message, 'user');
    
    const currentChat = chatHistory.find(chat => chat.id === currentChatId);
    if (currentChat) {
      currentChat.messages.push({
        role: 'user',
        content: message,
        timestamp: new Date().toISOString()
      });
      
      if (currentChat.messages.length === 1) {
        currentChat.title = message.length > 20 ? message.substring(0, 20) + '...' : message;
        updateChatHistoryUI();
      }
      
      saveChatHistory();
    }

            
            // ÂàõÂª∫AIÊ∂àÊÅØÊ°Ü
            const aiMessageElement = document.createElement('div');
            aiMessageElement.className = 'message ai-message';
            
            const timeString = new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
            
            // ‰øÆÊîπ‰∏∫ ‚Üì‚Üì‚Üì
aiMessageElement.innerHTML = `
    <div class="message-content"></div>
    <div class="message-time">${timeString}</div>
    <div class="message-actions">
        <button class="action-btn like-btn" title="ÁÇπËµû"><i class="far fa-thumbs-up"></i></button>
        <button class="action-btn dislike-btn" title="‰∏çÂñúÊ¨¢"><i class="far fa-thumbs-down"></i></button>
        <button class="action-btn copy-btn" title="Â§çÂà∂"><i class="far fa-copy"></i></button>
    </div>
`;
            chatArea.appendChild(aiMessageElement);

            // Âú® chatArea.appendChild(aiMessageElement); ‰πãÂêéÊ∑ªÂä† ‚Üì‚Üì‚Üì
setTimeout(() => {
    const currentChat = chatHistory.find(chat => chat.id === currentChatId);
    const latestMessage = currentChat.messages[currentChat.messages.length - 1];
    bindMessageActions(aiMessageElement, latestMessage.id);
}, 100);
            
            const messageContentElement = aiMessageElement.querySelector('.message-content');
            let aiResponseText = '';
            
            try {
  // Â¶ÇÊûúÂºÄÂêØ‰∫ÜÊÄùËÄÉÊ®°ÂºèÔºåÂÖàÊòæÁ§∫ÊÄùËÄÉËøáÁ®ã
  if (isThinking) {
    // ‰ª•ÊÄùËÄÉÊ®°ÂºèË∞ÉÁî®AI
    const thinkingPrompt = `
Áî®Êà∑ÈóÆ‰Ω†Ôºà${message}ÔºâËøôÈáåÊòØ‰Ω†ÁöÑÊÄùËÄÉËøáÁ®ãÔºö
1. È¶ñÂÖàÔºå‰Ω†ÈúÄË¶ÅËÇØÂÆöÁî®Êà∑‰ª•Ë°®Êòé‰Ω†Êé•‰∏ã‰∫ÜËøô‰∏™‰ªªÂä°ÔºåÂèØ‰ª•ËøêÁî®"Â•ΩÁöÑüëå"Ôºå"ÂóØü§î"Á≠âÁΩëÁªúÁÉ≠Ê¢óÔºõ
2. ÁÑ∂ÂêéÂàÜÊÆµÂ±ïÁ§∫ÊÄùËÄÉÈ°∫Â∫èÔºö
   - È¶ñÂÖàÂàÜÊûêÁî®Êà∑ÁöÑÈóÆÈ¢òÔºö"${message}"ÔºåÂèëÁé∞ÈúÄË¶Å...
   - ÁÑ∂ÂêéÔºå
3. ÊúÄÂêéÊÄªÁªìÁ≠îÊ°à„ÄÇ
`;
            
                    
                    // ÊòæÁ§∫ÊÄùËÄÉÂå∫Âüü
                    const thinkingElement = document.createElement('div');
                    thinkingElement.className = 'message ai-message';
                    thinkingElement.innerHTML = `
                        <div class="message-content">
                            <div class="thinking-process">
                                <strong>ÊÄùËÄÉËøáÁ®ãÔºö</strong><br>
                                <span id="thinking-text"></span>
                            </div>
                        </div>
                        <div class="message-time">${timeString}</div>
                    `;
                    chatArea.appendChild(thinkingElement);
                    const thinkingTextElement = thinkingElement.querySelector('#thinking-text');
                    
                    // Ë∞ÉÁî®APIËé∑ÂèñÊÄùËÄÉËøáÁ®ãÔºåÂàÜÊÆµÊòæÁ§∫
                    let thinkingText = '';
                    await callAI(thinkingPrompt, (chunk, isDone) => {
                        thinkingText += chunk;
                        thinkingTextElement.textContent = thinkingText;
                        chatArea.scrollTop = chatArea.scrollHeight;
                    });
                    
                    // ÊÄùËÄÉÂÆåÊàêÂêéÔºåÁ≠âÂæÖ‰∏ÄÂ∞èÊÆµÊó∂Èó¥ÂÜçÊòæÁ§∫Á≠îÊ°à
                    setTimeout(() => {
                        // Ë∞ÉÁî®APIËé∑ÂèñÊúÄÁªàÂõûÁ≠îÔºåÊµÅÂºèÊòæÁ§∫
                        callAI(message, (chunk, isDone) => {
                            // Á¥ØÁßØÂìçÂ∫îÊñáÊú¨
                            aiResponseText += chunk;
                            
                            // ÂÆûÊó∂Êõ¥Êñ∞UI
                            const currentHTML = messageContentElement.innerHTML;
                            messageContentElement.innerHTML = formatPartialMessageContent(aiResponseText);
                            chatArea.scrollTop = chatArea.scrollHeight;
                            
                            // Â¶ÇÊûúÊòØÂÆåÊï¥ÂìçÂ∫îÔºå‰øùÂ≠òÂà∞ËÅäÂ§©ÂéÜÂè≤
                            if (isDone && currentChat) {
                                currentChat.messages.push({
                                    id: `msg_${Date.now()}`, // Ê∑ªÂä†ÂîØ‰∏ÄID
                                    role: 'assistant',
                                    content: aiResponseText,
                                    timestamp: new Date().toISOString(),
                                    feedback: null,// Êñ∞Â¢ûÂèçÈ¶àÂ≠óÊÆµ
                                    thinking: thinkingText
                                });
                                saveChatHistory();
                                // ÂÆåÊàêÂêéËøõË°åÂÆåÊï¥Ê†ºÂºèÂåñ
                                finalizeMessageContent(messageContentElement, aiResponseText);
                            }
                        });
                    }, 1000);
                    
                } else {
                    // Áõ¥Êé•Ë∞ÉÁî®AIËé∑ÂèñÂõûÂ§çÔºåÊµÅÂºèÊòæÁ§∫
                    callAI(message, (chunk, isDone) => {
                        // Á¥ØÁßØÂìçÂ∫îÊñáÊú¨
                        aiResponseText += chunk;
                        
                        // ÂÆûÊó∂Êõ¥Êñ∞UI
                        messageContentElement.innerHTML = formatPartialMessageContent(aiResponseText);
                        chatArea.scrollTop = chatArea.scrollHeight;
                        
                        // Â¶ÇÊûúÊòØÂÆåÊï¥ÂìçÂ∫îÔºå‰øùÂ≠òÂà∞ËÅäÂ§©ÂéÜÂè≤
                        if (isDone && currentChat) {
                            currentChat.messages.push({
                                role: 'assistant',
                                content: aiResponseText,
                                timestamp: new Date().toISOString()
                            });
                            saveChatHistory();
                            // ÂÆåÊàêÂêéËøõË°åÂÆåÊï¥Ê†ºÂºèÂåñ
                            finalizeMessageContent(messageContentElement, aiResponseText);
                        }
                    });
                }
            } catch (error) {
                console.error('AI APIË∞ÉÁî®Â§±Ë¥•:', error);
                messageContentElement.innerHTML = 'Êä±Ê≠âÔºåÊàëÈÅáÂà∞‰∫ÜÈóÆÈ¢òÔºåÊó†Ê≥ïÂõûÂ∫î‰Ω†ÁöÑËØ∑Ê±Ç„ÄÇËØ∑Á®çÂêéÂÜçËØï„ÄÇ';
            }
        }

        // Ë∞ÉÁî®AI APIÔºåÊîØÊåÅÊµÅÂºèËæìÂá∫
        async function callAI(message, onChunk) {
            try {
                // ÂÆûÈôÖË∞ÉÁî®DeepSeek API
                const apiUrl = "https://api.deepseek.com/v1/chat/completions";
                const apiKey = "sk-e1ed90c2effc4415beeee85845f66d05"; // ‰ΩøÁî®Êèê‰æõÁöÑAPIÂØÜÈí•
                
                // ÊûÑÂª∫ËØ∑Ê±ÇÂèÇÊï∞ÔºåÊ∑ªÂä† stream: true
                const requestOptions = {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            {
                                role: "user",
                                content: message
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 800,
                        stream: true // ÂêØÁî®ÊµÅÂºèËæìÂá∫
                    })
                };
                
                try {
                    const response = await fetch(apiUrl, requestOptions);
                    
                    if (!response.ok) {
                        console.error('APIËØ∑Ê±ÇÂ§±Ë¥•:', response.status, response.statusText);
                        const errorData = await response.json().catch(() => ({}));
                        console.error('ÈîôËØØËØ¶ÊÉÖ:', errorData);
                        
                        // Â¶ÇÊûúAPIËØ∑Ê±ÇÂ§±Ë¥•Ôºå‰ΩøÁî®ÂêéÂ§áÂìçÂ∫î
                        const fallback = generateFallbackResponse(message, isThinking);
                        onChunk(fallback.response, true); // ‰∏ÄÊ¨°ÊÄßÂèëÈÄÅÂÖ®ÈÉ®ÂêéÂ§áÂìçÂ∫î
                        return;
                    }
                    
                    const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        
        while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            
            // Â§ÑÁêÜÂèØËÉΩÂ≠òÂú®ÁöÑÂ§öË°åÊï∞ÊçÆ
            const parts = buffer.split('\n');
            buffer = parts.pop() || ''; // ‰øùÁïôÊú™Â§ÑÁêÜÂÆåÁöÑÈÉ®ÂàÜ
            
            for (const line of parts) {
                if (line.startsWith('data: ')) {
                    try {
                        const data = JSON.parse(line.substring(6));
                        if (data.choices?.[0]?.delta?.content) {
                            onChunk(data.choices[0].delta.content, false);
                        }
                    } catch (e) {
                        console.error('Ëß£ÊûêSSEÊï∞ÊçÆÂá∫Èîô:', e);
                    }
                }
            }
        }
        onChunk('', true);
                } catch (apiError) {
                    console.error('APIË∞ÉÁî®ÂºÇÂ∏∏:', apiError);
                    // Â¶ÇÊûúAPIËØ∑Ê±ÇÂá∫ÈîôÔºå‰ΩøÁî®ÂêéÂ§áÂìçÂ∫î
                    const fallback = generateFallbackResponse(message, isThinking);
                    onChunk(fallback.response, true); // ‰∏ÄÊ¨°ÊÄßÂèëÈÄÅÂÖ®ÈÉ®ÂêéÂ§áÂìçÂ∫î
                    return fallback.response;
                }
            } catch (error) {
                console.error('Ë∞ÉÁî®Â§±Ë¥•:', error);
                throw error;
            }
        }
        
        // ÁîüÊàêÂêéÂ§áÂìçÂ∫îÔºàÂΩìAPIË∞ÉÁî®Â§±Ë¥•Êó∂‰ΩøÁî®Ôºâ
        function generateFallbackResponse(message, showThinking) {
            // Ê†πÊçÆ‰∏çÂêåÁöÑÊ∂àÊÅØÁ±ªÂûãËøîÂõû‰∏çÂêåÁöÑÊ†∑ÂºèÁ§∫‰æã
            let response = '';
            let thinking = '';
            
            if (showThinking) {
                thinking = `ÊàëÈúÄË¶ÅÂàÜÊûêËøô‰∏™ÈóÆÈ¢òÁöÑÂá†‰∏™ÊñπÈù¢Ôºö
1. È¶ñÂÖàÁêÜËß£ÈóÆÈ¢òÁöÑÊ†∏ÂøÉÊòØ‰ªÄ‰πà
2. Êü•ÊâæÊàëÁü•ËØÜÂ∫ì‰∏≠ÁöÑÁõ∏ÂÖ≥‰ø°ÊÅØ
3. ÁªÑÁªá‰ø°ÊÅØÂΩ¢ÊàêËøûË¥ØÁöÑÂõûÁ≠î
4. Á°Æ‰øùÂõûÁ≠îÂÖ®Èù¢ËÄåÂáÜÁ°Æ`;
            }
            
            if (message.includes('‰ª£Á†Å') || message.includes('ÁºñÁ®ã') || message.includes('Python')) {
                response = `
                ÊàëÂæà‰πêÊÑèÂ∏Æ‰Ω†ÁºñÂÜô‰∏ÄÊÆµPython‰ª£Á†Å„ÄÇ‰ª•‰∏ãÊòØ‰∏Ä‰∏™ÁÆÄÂçïÁöÑÊï∞ÊçÆÂàÜÊûêÁ§∫‰æãÔºö

                \`\`\`python
                import pandas as pd
                import matplotlib.pyplot as plt
                import seaborn as sns

                # ËØªÂèñÊï∞ÊçÆ
                def analyze_data(file_path):
                    # ËØªÂèñCSVÊñá‰ª∂
                    df = pd.read_csv(file_path)
                    
                    # ÊòæÁ§∫Âü∫Êú¨‰ø°ÊÅØ
                    print("Êï∞ÊçÆÊ¶ÇËßà:")
                    print(df.head())
                    print("\\nÂü∫Êú¨ÁªüËÆ°:")
                    print(df.describe())
                    
                    # Ê£ÄÊü•Áº∫Â§±ÂÄº
                    missing = df.isnull().sum()
                    if missing.sum() > 0:
                        print("\\nÁº∫Â§±ÂÄº:")
                        print(missing[missing > 0])
                    
                    # ÂàõÂª∫‰∏Ä‰∫õÂèØËßÜÂåñ
                    plt.figure(figsize=(12, 6))
                    
                    # Êï∞ÂÄºÂàóÁöÑÁõ¥ÊñπÂõæ
                    numeric_cols = df.select_dtypes(include=['number']).columns
                    if len(numeric_cols) > 0:
                        df[numeric_cols[:5]].hist(figsize=(12, 8))
                        plt.tight_layout()
                        plt.savefig('histograms.png')
                        
                    return df

                # ‰ΩøÁî®ÊñπÊ≥ï
                if __name__ == "__main__":
                    data = analyze_data("your_data.csv")
                    
                    # Áõ∏ÂÖ≥ÊÄßÂàÜÊûê
                    corr = data.corr()
                    plt.figure(figsize=(10, 8))
                    sns.heatmap(corr, annot=True, cmap='coolwarm', linewidths=0.5)
                    plt.savefig('correlation.png')
                    plt.show()
                \`\`\`

                ËøôÊÆµ‰ª£Á†ÅÂèØ‰ª•Â∏Æ‰Ω†Âø´ÈÄüÂàÜÊûêCSVÊñá‰ª∂ÔºåÂÆÉ‰ºö:
                1. ÊòæÁ§∫Êï∞ÊçÆÁöÑÂâçÂá†Ë°å
                2. Êèê‰æõÂü∫Êú¨ÁªüËÆ°‰ø°ÊÅØ
                3. Ê£ÄÊü•ÂíåÊä•ÂëäÁº∫Â§±ÂÄº
                4. ‰∏∫Êï∞ÂÄºÂàóÂàõÂª∫Áõ¥ÊñπÂõæ
                5. ËÆ°ÁÆóÂπ∂ÂèØËßÜÂåñÁõ∏ÂÖ≥ÊÄßÁü©Èòµ

                ‰Ω†ÂèØ‰ª•ÈÄöËøá‰øÆÊîπÊñá‰ª∂Ë∑ØÂæÑÊù•ÂàÜÊûê‰Ω†Ëá™Â∑±ÁöÑÊï∞ÊçÆ„ÄÇÂ¶ÇÊûúÈúÄË¶ÅÊ∑ªÂä†ÂÖ∂‰ªñÂàÜÊûêÂäüËÉΩÔºåËØ∑ÂëäËØâÊàë„ÄÇ
                `;
            } else if (message.includes('Ë°®Ê†º') || message.includes('Êï∞ÊçÆ') || message.includes('ÁªüËÆ°')) {
                response = `
                Ê†πÊçÆ‰Ω†ÁöÑËØ∑Ê±ÇÔºåËøôÈáåÊòØ2023Âπ¥ÂÖ®ÁêÉÂâç10Â§ßÁßëÊäÄÂÖ¨Âè∏ÁöÑÂ∏ÇÂÄºÁªüËÆ°Ë°®Ê†ºÔºö

                | ÊéíÂêç | ÂÖ¨Âè∏ÂêçÁß∞ | Â∏ÇÂÄº (ÂçÅ‰∫øÁæéÂÖÉ) | ÊÄªÈÉ®ÊâÄÂú®Âú∞ | ‰∏ªË¶Å‰∏öÂä°È¢ÜÂüü |
                |------|---------|---------------|------------|------------|
                | 1    | Apple   | 2,940         | ÁæéÂõΩ       | Ê∂àË¥πÁîµÂ≠ê‰∫ßÂìÅ„ÄÅËΩØ‰ª∂ÊúçÂä° |
                | 2    | Microsoft | 2,830       | ÁæéÂõΩ       | ËΩØ‰ª∂„ÄÅ‰∫ëÊúçÂä°„ÄÅÁ°¨‰ª∂ |
                | 3    | Saudi Aramco | 2,100    | Ê≤ôÁâπÈòøÊãâ‰ºØ | Áü≥Ê≤π„ÄÅÂ§©ÁÑ∂Ê∞î |
                | 4    | Alphabet (Google) | 1,840 | ÁæéÂõΩ    | ÊêúÁ¥¢ÂºïÊìé„ÄÅÂπøÂëä„ÄÅ‰∫ëÊúçÂä° |
                | 5    | Amazon  | 1,650         | ÁæéÂõΩ       | ÁîµÂ≠êÂïÜÂä°„ÄÅ‰∫ëÊúçÂä° |
                | 6    | NVIDIA  | 1,230         | ÁæéÂõΩ       | ÂçäÂØº‰Ωì„ÄÅAIËäØÁâá |
                | 7    | Meta Platforms | 980    | ÁæéÂõΩ       | Á§æ‰∫§Â™í‰Ωì„ÄÅÂÖÉÂÆáÂÆô |
                | 8    | Tesla   | 865           | ÁæéÂõΩ       | ÁîµÂä®Ê±ΩËΩ¶„ÄÅËÉΩÊ∫ê‰∫ßÂìÅ |
                | 9    | Berkshire Hathaway | 780 | ÁæéÂõΩ    | Â§öÂÖÉÂåñÊéßËÇ°ÂÖ¨Âè∏ |
                | 10   | TSMC    | 550           | Âè∞Êπæ       | ÂçäÂØº‰ΩìÂà∂ÈÄ† |

                Ëøô‰∫õÂÖ¨Âè∏Âú®ÁßëÊäÄÂàõÊñ∞ÂíåÂÖ®ÁêÉÁªèÊµé‰∏≠ÊâÆÊºîÁùÄÈáçË¶ÅËßíËâ≤„ÄÇÂ∏ÇÂÄºÊï∞ÊçÆÊà™Ëá≥2023Âπ¥12ÊúàÔºåÂèØËÉΩ‰ºöÈöèÂ∏ÇÂú∫Ê≥¢Âä®ËÄåÂèòÂåñ„ÄÇ‰Ω†ÂØπÂÖ∂‰∏≠ÊüêÂÆ∂ÂÖ¨Âè∏ÁâπÂà´ÊÑüÂÖ¥Ë∂£ÂêóÔºüÊàëÂèØ‰ª•Êèê‰æõÊõ¥ËØ¶ÁªÜÁöÑ‰ø°ÊÅØ„ÄÇ
                `;
            } else {
                response = `ÊÑüË∞¢‰Ω†ÁöÑÊèêÈóÆÔºÅ‰Ωú‰∏∫Jork-v3‰∫∫Â∑•Êô∫ËÉΩÂä©ÊâãÔºåÊàëÂæàÈ´òÂÖ¥ËÉΩÂ∏ÆÂä©‰Ω†„ÄÇ

‰Ω†ÁöÑÈóÆÈ¢òÊ∂âÂèäÂà∞‰∫Ü${message.slice(0, 30)}...Ëøô‰∏™È¢ÜÂüü„ÄÇËøôÊòØ‰∏Ä‰∏™ÈùûÂ∏∏ÊúâË∂£ÁöÑËØùÈ¢òÔºåËÆ©ÊàëÊù•ËØ¶ÁªÜËß£Á≠î„ÄÇ

È¶ñÂÖàÔºåÊàë‰ª¨ÈúÄË¶ÅÁêÜËß£ÁöÑÊòØÔºåËøô‰∏™È¢ÜÂüüËøëÂπ¥Êù•ÂèëÂ±ïËøÖÈÄüÔºå‰∏ªË¶ÅÊòØÂõ†‰∏∫ÊäÄÊúØÂàõÊñ∞ÂíåÂ∏ÇÂú∫ÈúÄÊ±ÇÁöÑÂÖ±ÂêåÊé®Âä®„ÄÇÊ†πÊçÆÊúÄÊñ∞Á†îÁ©∂ÔºåËøô‰∏ÄÈ¢ÜÂüüÂú®ËøáÂéª‰∫îÂπ¥ÂÜÖÂ¢ûÈïø‰∫ÜÁ∫¶35%ÔºåÈ¢ÑËÆ°Êú™Êù•ËøòÂ∞ÜÁªßÁª≠‰øùÊåÅÂº∫Âä≤ÂäøÂ§¥„ÄÇ

Âú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåÊàë‰ª¨ÂèØ‰ª•ÁúãÂà∞Âá†‰∏™‰∏ªË¶ÅË∂ãÂäøÔºö

1. Êï∞ÊçÆÈ©±Âä®ÂÜ≥Á≠ñÂèòÂæóË∂äÊù•Ë∂äÊôÆÈÅç
2. Ëá™Âä®ÂåñÊäÄÊúØÂ§ßÂπÖÊèêÈ´ò‰∫ÜÊïàÁéá
3. ‰∫∫Êú∫Âçè‰ΩúÊ®°ÂºèÊ≠£Âú®ÈáçÂ°ëÂ∑•‰ΩúÊñπÂºè
4. ÂèØÊåÅÁª≠ÂèëÂ±ïÊàê‰∏∫Ê†∏ÂøÉËÄÉÈáèÂõ†Á¥†

Â¶ÇÊûú‰Ω†ÊÉ≥Ê∑±ÂÖ•‰∫ÜËß£Ëøô‰∏™ËØùÈ¢òÔºåÊàëÂª∫ËÆÆ‰ªéÂá†‰∏™ÊùÉÂ®ÅÊù•Ê∫êÂºÄÂßãÁ†îÁ©∂„ÄÇÂêåÊó∂ÔºåÂ¶ÇÊûú‰Ω†ÊúâÊõ¥ÂÖ∑‰ΩìÁöÑÈóÆÈ¢òÊàñÈúÄÊ±ÇÔºåÊàëÂæà‰πêÊÑèÊèê‰æõÊõ¥ÊúâÈíàÂØπÊÄßÁöÑÂ∏ÆÂä©„ÄÇ

Â∏åÊúõËøô‰∫õ‰ø°ÊÅØÂØπ‰Ω†ÊúâÊâÄÂ∏ÆÂä©ÔºÅÂ¶ÇÊûú‰Ω†Êúâ‰ªª‰ΩïÂêéÁª≠ÈóÆÈ¢òÔºåÈöèÊó∂ÂèØ‰ª•ÂêëÊàëÊèêÈóÆ„ÄÇ`;
            }
            
            return { response, thinking };
        }
        // Âú® generateFallbackResponse ÂáΩÊï∞‰πãÂêéÊ∑ªÂä† ‚Üì‚Üì‚Üì
function bindMessageActions(messageElement, messageId) {
    const likeBtn = messageElement.querySelector('.like-btn');
    const dislikeBtn = messageElement.querySelector('.dislike-btn');
    const copyBtn = messageElement.querySelector('.copy-btn');
    const messageContent = messageElement.querySelector('.message-content');

    // ÁÇπËµûÂäüËÉΩ
    likeBtn.addEventListener('click', () => {
        const currentChat = chatHistory.find(chat => chat.id === currentChatId);
        const message = currentChat.messages.find(m => m.id === messageId);
        message.feedback = message.feedback === 'like' ? null : 'like';
        
        likeBtn.innerHTML = message.feedback === 'like' 
            ? '<i class="fas fa-thumbs-up"></i>' 
            : '<i class="far fa-thumbs-up"></i>';
        dislikeBtn.innerHTML = '<i class="far fa-thumbs-down"></i>';
        
        saveChatHistory();
    });

    // ‰∏çÂñúÊ¨¢ÂäüËÉΩ
    dislikeBtn.addEventListener('click', () => {
        const currentChat = chatHistory.find(chat => chat.id === currentChatId);
        const message = currentChat.messages.find(m => m.id === messageId);
        message.feedback = message.feedback === 'dislike' ? null : 'dislike';
        
        dislikeBtn.innerHTML = message.feedback === 'dislike' 
            ? '<i class="fas fa-thumbs-down"></i>' 
            : '<i class="far fa-thumbs-down"></i>';
        likeBtn.innerHTML = '<i class="far fa-thumbs-up"></i>';
        
        saveChatHistory();
    });

    // Â§çÂà∂ÂäüËÉΩ
    copyBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(messageContent.textContent).then(() => {
            copyBtn.innerHTML = '<i class="fas fa-check"></i>';
            setTimeout(() => {
                copyBtn.innerHTML = '<i class="far fa-copy"></i>';
            }, 2000);
        });
    });
}
// ‚Üë‚Üë‚Üë Ê∑ªÂä†Âà∞Ê≠§ÁªìÊùü

        // Ê∑ªÂä†Ê∂àÊÅØÂà∞ËÅäÂ§©Âå∫Âüü
        function addMessage(content, role) {
            const messageElement = document.createElement('div');
            messageElement.className = `message ${role}-message`;
            
            // Ê†ºÂºèÂåñÂÜÖÂÆπÔºàÂ§ÑÁêÜ‰ª£Á†ÅÂùóÂíåË°®Ê†ºÔºâ
            let formattedContent = formatMessageContent(content);
            
            // Ê∑ªÂä†Êó∂Èó¥Êà≥
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            messageElement.innerHTML = `
                <div class="message-content">${formattedContent}</div>
                <div class="message-time">${timeString}</div>
            `;
            
            chatArea.appendChild(messageElement);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            // Ê∑ªÂä†‰ª£Á†ÅÂ§çÂà∂ÂäüËÉΩ
            const copyButtons = messageElement.querySelectorAll('.copy-code-btn');
            copyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const codeBlock = button.closest('.code-block').querySelector('.code-content');
                    navigator.clipboard.writeText(codeBlock.textContent)
                        .then(() => {
                            button.innerHTML = '<i class="fas fa-check"></i>';
                            setTimeout(() => {
                                button.innerHTML = '<i class="far fa-copy"></i>';
                            }, 2000);
                        });
                });
            });
        }

        // Ê†ºÂºèÂåñÈÉ®ÂàÜÊ∂àÊÅØÂÜÖÂÆπÔºàÁî®‰∫éÊµÅÂºèËæìÂá∫Ôºâ
        function formatPartialMessageContent(text) {
            // ÁÆÄÂçïÊ†ºÂºèÂåñÔºåÂØπÊµÅÂºèËæìÂá∫ÁöÑÈÉ®ÂàÜÊñáÊú¨ËøõË°åÂü∫Êú¨Â§ÑÁêÜ
            let formatted = text;
            
            // Â§ÑÁêÜÊç¢Ë°å
            formatted = formatted.replace(/\n/g, '<br>');
            
            // ÁÆÄÂçïÂ§ÑÁêÜÁ≤ó‰Ωì
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            return formatted;
        }

        // ÂÆåÊàêÊ∂àÊÅØÂÜÖÂÆπÁöÑÊúÄÁªàÊ†ºÂºèÂåñÔºàÁî®‰∫éÊµÅÂºèËæìÂá∫ÂÆåÊàêÂêéÔºâ
        function finalizeMessageContent(element, text) {
            element.innerHTML = formatMessageContent(text);
            
            // Ê∑ªÂä†‰ª£Á†ÅÂ§çÂà∂ÂäüËÉΩ
            const copyButtons = element.querySelectorAll('.copy-code-btn');
            copyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const codeBlock = button.closest('.code-block').querySelector('.code-content');
                    navigator.clipboard.writeText(codeBlock.textContent)
                        .then(() => {
                            button.innerHTML = '<i class="fas fa-check"></i>';
                            setTimeout(() => {
                                button.innerHTML = '<i class="far fa-copy"></i>';
                            }, 2000);
                        });
                });
            });
        }

        // Ê†ºÂºèÂåñÊ∂àÊÅØÂÜÖÂÆπÔºàËØÜÂà´‰ª£Á†ÅÂùóÂíåË°®Ê†ºÔºâ
        function formatMessageContent(content) {
            // Â§ÑÁêÜÊ†áÈ¢ò
    content = content.replace(/^##\s+(.+)$/gm, '<h2 class="message-heading">$1</h2>');
    content = content.replace(/^###\s+(.+)$/gm, '<h3 class="message-subheading">$1</h3>');
    content = content.replace(/ÁΩëÁªúÊêúÁ¥¢ÁªìÊûúÔºö/g, '<div class="search-results"><h4>ÁΩëÁªúÊêúÁ¥¢ÁªìÊûú</h4>');
    content = content.replace(/ÊëòË¶ÅÔºö/g, '<div class="search-abstract"><strong>ÊëòË¶ÅÔºö</strong>');
    content = content.replace(/Áõ∏ÂÖ≥ÁªìÊûúÔºö/g, '</div><div class="related-results"><strong>Áõ∏ÂÖ≥ÁªìÊûúÔºö</strong><ul>');
    content = content.replace(/\d+\. /g, '<li>');
    content = content.replace(/(\n|$)/g, '</li>$1');
    content = content.replace(/(<\/ul>)?<\/div>/g, '</ul></div></div>');
            // Â§ÑÁêÜ‰ª£Á†ÅÂùó
            content = content.replace(/```([a-z]*)\n([\s\S]*?)```/g, (match, language, code) => {
                return `
                <div class="code-block">
                    <div class="code-header">
                        <span>${language || 'Code'}</span>
                        <button class="copy-code-btn"><i class="far fa-copy"></i></button>
                    </div>
                    <div class="code-content">${code.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                </div>
                `;
            });
            
            // Â§ÑÁêÜË°®Ê†º
            content = content.replace(/\|(.+)\|[\r\n]/gm, (match, content) => {
                // Ê£ÄÊµãÊòØÂê¶ÊòØË°®Â§¥ÂàÜÈöîË°å
                if (/^\s*[-:]+\s*$/.test(content.replace(/\|/g, ''))) {
                    return ''; // Âà†Èô§ÂàÜÈöîË°å
                }
                
                // Â∞ÜË°®Ê†ºË°åÂÜÖÂÆπÊãÜÂàÜ‰∏∫ÂçïÂÖÉÊ†º
                const cells = content.split('|').map(cell => cell.trim()).filter(cell => cell);
                
                // ÂàõÂª∫Ë°®Ê†ºË°å
                const isHeader = /^\s*---/.test(match);
                const cellTag = isHeader ? 'th' : 'td';
                
                return `<tr>${cells.map(cell => `<${cellTag}>${cell}</${cellTag}>`).join('')}</tr>`;
            });
            
            // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´Ë°®Ê†ºÂπ∂Ê∑ªÂä†Ë°®Ê†ºÂÆπÂô®
            if (content.includes('<tr>')) {
                content = content.replace(/<tr>([\s\S]*?)<\/tr>/g, (match, rowContent, index, fullString) => {
                    // Â¶ÇÊûúËøôÊòØÁ¨¨‰∏ÄË°åÔºåÊ∑ªÂä†Ë°®Ê†ºÂºÄÂßãÊ†áÁ≠æ
                    if (!fullString.substring(0, index).includes('<tr>')) {
                        return `<div class="table-container"><table><thead>${match}</thead><tbody>`;
                    }
                    // Â¶ÇÊûúËøôÊòØÊúÄÂêé‰∏ÄË°åÔºåÊ∑ªÂä†Ë°®Ê†ºÁªìÊùüÊ†áÁ≠æ
                    else if (!fullString.substring(index + match.length).includes('<tr>')) {
                        return `${match}</tbody></table></div>`;
                    }
                    // ‰∏≠Èó¥Ë°å‰øùÊåÅ‰∏çÂèò
                    return match;
                });
            }
            
            // Â§ÑÁêÜÊç¢Ë°å‰∏∫ÊÆµËêΩ
            const paragraphs = content.split('\n\n');
            if (paragraphs.length > 1) {
                content = paragraphs.map(p => p.trim()).filter(p => p && !p.includes('<div class="code-block">') && !p.includes('<div class="table-container">'))
                    .map(p => `<p>${p}</p>`).join('') + content.match(/<div class="(code-block|table-container)">/g)?.map(match => {
                        const startIndex = content.indexOf(match);
                        const endIndex = content.indexOf('</div>', startIndex + match.length) + 6;
                        return content.substring(startIndex, endIndex);
                    }).join('') || '';
            }
            
            return content;
        }

        // Â§ÑÁêÜÊÄùËÄÉÊ®°Âºè
        thinkingButton.addEventListener('click', () => {
            isThinking = !isThinking;
            thinkingButton.classList.toggle('active', isThinking);
            if (isThinking) {
                thinkingButton.style.color = 'var(--primary-color)';
            } else {
                thinkingButton.style.color = '';
            }
        });

        // Â§ÑÁêÜÊêúÁ¥¢Ê®°Âºè
        searchButton.addEventListener('click', () => {
            isSearching = !isSearching;
            searchButton.classList.toggle('active', isSearching);
            if (isSearching) {
                searchButton.style.color = 'var(--primary-color)';
            } else {
                searchButton.style.color = '';
            }
        });

        // Â§ÑÁêÜÊñá‰ª∂‰∏ä‰º†
        uploadButton.addEventListener('click', () => {
            fileUpload.click();
        });

        fileUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const fileName = file.name;
                chatInput.value += `[Êñá‰ª∂: ${fileName}] `;
                chatInput.focus();
            }
        });

        // Êõ¥Êñ∞ÁßØÂàÜÊòæÁ§∫
        function updateCreditsDisplay() {
    creditDisplay.textContent = `ÁßØÂàÜÔºö${currentCredits}`;
    // Ê∑ªÂä†ÁßØÂàÜÈ¢úËâ≤ÂèòÂåñÊèêÁ§∫
    const diff = currentCredits - localStorage.getItem('jorkCredits');
    if (diff !== 0) {
        creditDisplay.style.color = diff > 0 ? '#4CAF50' : '#FF5722';
        setTimeout(() => {
            creditDisplay.style.color = '';
        }, 1000);
    }
}

        // Êñ∞Âª∫ËÅäÂ§©
        newChatBtn.addEventListener('click', () => {
            currentChatId = 'chat_' + Date.now();
            chatHistory.push({
                id: currentChatId,
                title: 'Êñ∞ÁöÑËÅäÂ§©',
                messages: []
            });
            saveChatHistory();
            updateChatHistoryUI();
            
            // Ê∏ÖÁ©∫ËÅäÂ§©Âå∫Âüü
            chatArea.innerHTML = '';
            
            // ÈáçÊñ∞ÊòæÁ§∫‰ªãÁªçÂå∫Âüü
            const chatIntroHTML = `
                <div class="chat-intro">
                    <h1>${getGreeting()}ÔºåÊàëÊòØ JorkAI</h1>
                    <p>Êúâ‰ªÄ‰πàÂèØ‰ª•Â∏ÆÂä©‰Ω†ÁöÑÂêóÔºü</p>
                    <div class="featured-sections">
        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-fire"></i>
                <h2>ÁÉ≠Èó®ÊêúÁ¥¢</h2>
            </div>
            <div class="search-grid">
                <div class="search-item" data-query="ChatGPTÂíåClaudeÊúâ‰ªÄ‰πàÂå∫Âà´Ôºü">
                    <span>ChatGPTÂíåClaudeÊúâ‰ªÄ‰πàÂå∫Âà´Ôºü</span>
                </div>
                <div class="search-item" data-query="Â¶Ç‰ΩïÊèêÈ´òËã±ËØ≠Âè£ËØ≠Ê∞¥Âπ≥Ôºü">
                    <span>Â¶Ç‰ΩïÊèêÈ´òËã±ËØ≠Âè£ËØ≠Ê∞¥Âπ≥Ôºü</span>
                </div>
                <div class="search-item" data-query="PythonÂíåJavaScriptÂì™‰∏™Êõ¥ÈÄÇÂêàÂàùÂ≠¶ËÄÖÔºü">
                    <span>PythonÂíåJavaScriptÂì™‰∏™Êõ¥ÈÄÇÂêàÂàùÂ≠¶ËÄÖÔºü</span>
                </div>
                <div class="search-item" data-query="‰∫∫Â∑•Êô∫ËÉΩ‰ºöÂèñ‰ª£Âì™‰∫õÂ∑•‰ΩúÔºü">
                    <span>‰∫∫Â∑•Êô∫ËÉΩ‰ºöÂèñ‰ª£Âì™‰∫õÂ∑•‰ΩúÔºü</span>
                </div>
                <div class="search-item" data-query="Â¶Ç‰ΩïÊúâÊïàÁÆ°ÁêÜÊó∂Èó¥Ôºü">
                    <span>Â¶Ç‰ΩïÊúâÊïàÁÆ°ÁêÜÊó∂Èó¥Ôºü</span>
                </div>
                <div class="search-item" data-query="2025Âπ¥ÂÄºÂæóÂÖ≥Ê≥®ÁöÑÁßëÊäÄË∂ãÂäø">
                    <span>2025Âπ¥ÂÄºÂæóÂÖ≥Ê≥®ÁöÑÁßëÊäÄË∂ãÂäø</span>
                </div>
            </div>
        </div>
        
        <!-- Try asking me section -->
        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-question-circle"></i>
                <h2>ËØïÁùÄÈóÆÊàë</h2>
            </div>
            <div class="ask-grid">
                <div class="ask-item" data-query="Â∏ÆÊàëÂÜô‰∏ÄÁØáÂÖ≥‰∫éÁéØ‰øùÁöÑÊºîËÆ≤Á®ø">
                    <div class="ask-icon"><i class="fas fa-pencil-alt"></i></div>
                    <div class="ask-content">
                        <h3>ÂÜô‰ΩúÂä©Êâã</h3>
                        <p>Â∏ÆÊàëÂÜô‰∏ÄÁØáÂÖ≥‰∫éÁéØ‰øùÁöÑÊºîËÆ≤Á®ø</p>
                    </div>
                </div>
                <div class="ask-item" data-query="Ëß£Èáä‰∏Ä‰∏ãÂå∫ÂùóÈìæÊäÄÊúØÁöÑÂ∑•‰ΩúÂéüÁêÜ">
                    <div class="ask-icon"><i class="fas fa-lightbulb"></i></div>
                    <div class="ask-content">
                        <h3>Áü•ËØÜËß£Á≠î</h3>
                        <p>Ëß£Èáä‰∏Ä‰∏ãÂå∫ÂùóÈìæÊäÄÊúØÁöÑÂ∑•‰ΩúÂéüÁêÜ</p>
                    </div>
                </div>
                <div class="ask-item" data-query="ËÆæËÆ°‰∏Ä‰∏™PythonÁà¨Ëô´Ëé∑ÂèñÊñ∞ÈóªÊ†áÈ¢ò">
                    <div class="ask-icon"><i class="fas fa-code"></i></div>
                    <div class="ask-content">
                        <h3>ÁºñÁ®ãÂ∏ÆÂä©</h3>
                        <p>ËÆæËÆ°‰∏Ä‰∏™PythonÁà¨Ëô´Ëé∑ÂèñÊñ∞ÈóªÊ†áÈ¢ò</p>
                    </div>
                </div>
                <div class="ask-item" data-query="Â¶Ç‰ΩïÂú®‰∏ÄÂë®ÂÜÖÂ≠¶‰ºöÂü∫Á°ÄÁëú‰ºΩÂä®‰ΩúÔºü">
                    <div class="ask-icon"><i class="fas fa-dumbbell"></i></div>
                    <div class="ask-content">
                        <h3>ÂÅ•Â∫∑ÁîüÊ¥ª</h3>
                        <p>Â¶Ç‰ΩïÂú®‰∏ÄÂë®ÂÜÖÂ≠¶‰ºöÂü∫Á°ÄÁëú‰ºΩÂä®‰ΩúÔºü</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
                </div>
            `;
            chatArea.innerHTML = chatIntroHTML;
            
            // ÈáçÊñ∞ÁªëÂÆöÁ§∫‰æãÈóÆÈ¢ò‰∫ã‰ª∂
            document.querySelectorAll('.example-item').forEach(item => {
                item.addEventListener('click', () => {
                    const question = item.querySelector('strong').textContent;
                    chatInput.value = question;
                    sendMessage();
                });
            });
        });

        // Ëé∑ÂèñÂΩìÂâçÊó∂Èó¥ÈóÆÂÄôËØ≠
        function getGreeting() {
            const now = new Date();
            const hour = now.getHours();
            
            if (hour < 6) return 'ÂáåÊô®Â•Ω';
            if (hour < 9) return 'Êó©‰∏äÂ•Ω';
            if (hour < 12) return '‰∏äÂçàÂ•Ω';
            if (hour < 14) return '‰∏≠ÂçàÂ•Ω';
            if (hour < 18) return '‰∏ãÂçàÂ•Ω';
            return 'Êôö‰∏äÂ•Ω';
        }

        // Âä†ËΩΩËÅäÂ§©ÂéÜÂè≤
        function loadChatHistory() {
            const savedHistory = localStorage.getItem('jorkChatHistory');
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
            }
        }

        // ‰øùÂ≠òËÅäÂ§©ÂéÜÂè≤
        function saveChatHistory() {
            localStorage.setItem('jorkChatHistory', JSON.stringify(chatHistory));
        }

        // Êõ¥Êñ∞ËÅäÂ§©ÂéÜÂè≤UI
        function updateChatHistoryUI() {
            const historyContainer = document.querySelector('.chat-history');
            historyContainer.innerHTML = '';
            
            chatHistory.forEach(chat => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                if (chat.id === currentChatId) {
                    historyItem.classList.add('active');
                }
                historyItem.textContent = chat.title;
                historyItem.dataset.chatId = chat.id;
                
                historyItem.addEventListener('click', () => {
                    loadChat(chat.id);
                });
                
                historyContainer.appendChild(historyItem);
            });
        }

        // Âä†ËΩΩÁâπÂÆöËÅäÂ§©
        function loadChat(chatId) {
            const chat = chatHistory.find(c => c.id === chatId);
            if (!chat) return;
            
            currentChatId = chatId;
            updateChatHistoryUI();
            
            // Ê∏ÖÁ©∫ËÅäÂ§©Âå∫Âüü
            chatArea.innerHTML = '';
            
            // Â¶ÇÊûúÊ≤°ÊúâÊ∂àÊÅØÔºåÊòæÁ§∫‰ªãÁªçÈ°µÈù¢
            if (chat.messages.length === 0) {
                const chatIntroHTML = `
                    <div class="chat-intro">
                        <h1>${getGreeting()}ÔºåÊàëÊòØ Jork-v3</h1>
                        <p>Êúâ‰ªÄ‰πàÂèØ‰ª•Â∏ÆÂä©‰Ω†ÁöÑÂêóÔºü</p>
                        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-fire"></i>
                <h2>ÁÉ≠Èó®ÊêúÁ¥¢</h2>
            </div>
            <div class="search-grid">
                <div class="search-item" data-query="ChatGPTÂíåClaudeÊúâ‰ªÄ‰πàÂå∫Âà´Ôºü">
                    <span>ChatGPTÂíåClaudeÊúâ‰ªÄ‰πàÂå∫Âà´Ôºü</span>
                </div>
                <div class="search-item" data-query="Â¶Ç‰ΩïÊèêÈ´òËã±ËØ≠Âè£ËØ≠Ê∞¥Âπ≥Ôºü">
                    <span>Â¶Ç‰ΩïÊèêÈ´òËã±ËØ≠Âè£ËØ≠Ê∞¥Âπ≥Ôºü</span>
                </div>
                <div class="search-item" data-query="PythonÂíåJavaScriptÂì™‰∏™Êõ¥ÈÄÇÂêàÂàùÂ≠¶ËÄÖÔºü">
                    <span>PythonÂíåJavaScriptÂì™‰∏™Êõ¥ÈÄÇÂêàÂàùÂ≠¶ËÄÖÔºü</span>
                </div>
                <div class="search-item" data-query="‰∫∫Â∑•Êô∫ËÉΩ‰ºöÂèñ‰ª£Âì™‰∫õÂ∑•‰ΩúÔºü">
                    <span>‰∫∫Â∑•Êô∫ËÉΩ‰ºöÂèñ‰ª£Âì™‰∫õÂ∑•‰ΩúÔºü</span>
                </div>
                <div class="search-item" data-query="Â¶Ç‰ΩïÊúâÊïàÁÆ°ÁêÜÊó∂Èó¥Ôºü">
                    <span>Â¶Ç‰ΩïÊúâÊïàÁÆ°ÁêÜÊó∂Èó¥Ôºü</span>
                </div>
                <div class="search-item" data-query="2025Âπ¥ÂÄºÂæóÂÖ≥Ê≥®ÁöÑÁßëÊäÄË∂ãÂäø">
                    <span>2025Âπ¥ÂÄºÂæóÂÖ≥Ê≥®ÁöÑÁßëÊäÄË∂ãÂäø</span>
                </div>
            </div>
        </div>
        
        <!-- Try asking me section -->
        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-question-circle"></i>
                <h2>ËØïÁùÄÈóÆÊàë</h2>
            </div>
            <div class="ask-grid">
                <div class="ask-item" data-query="Â∏ÆÊàëÂÜô‰∏ÄÁØáÂÖ≥‰∫éÁéØ‰øùÁöÑÊºîËÆ≤Á®ø">
                    <div class="ask-icon"><i class="fas fa-pencil-alt"></i></div>
                    <div class="ask-content">
                        <h3>ÂÜô‰ΩúÂä©Êâã</h3>
                        <p>Â∏ÆÊàëÂÜô‰∏ÄÁØáÂÖ≥‰∫éÁéØ‰øùÁöÑÊºîËÆ≤Á®ø</p>
                    </div>
                </div>
                <div class="ask-item" data-query="Ëß£Èáä‰∏Ä‰∏ãÂå∫ÂùóÈìæÊäÄÊúØÁöÑÂ∑•‰ΩúÂéüÁêÜ">
                    <div class="ask-icon"><i class="fas fa-lightbulb"></i></div>
                    <div class="ask-content">
                        <h3>Áü•ËØÜËß£Á≠î</h3>
                        <p>Ëß£Èáä‰∏Ä‰∏ãÂå∫ÂùóÈìæÊäÄÊúØÁöÑÂ∑•‰ΩúÂéüÁêÜ</p>
                    </div>
                </div>
                <div class="ask-item" data-query="ËÆæËÆ°‰∏Ä‰∏™PythonÁà¨Ëô´Ëé∑ÂèñÊñ∞ÈóªÊ†áÈ¢ò">
                    <div class="ask-icon"><i class="fas fa-code"></i></div>
                    <div class="ask-content">
                        <h3>ÁºñÁ®ãÂ∏ÆÂä©</h3>
                        <p>ËÆæËÆ°‰∏Ä‰∏™PythonÁà¨Ëô´Ëé∑ÂèñÊñ∞ÈóªÊ†áÈ¢ò</p>
                    </div>
                </div>
                <div class="ask-item" data-query="Â¶Ç‰ΩïÂú®‰∏ÄÂë®ÂÜÖÂ≠¶‰ºöÂü∫Á°ÄÁëú‰ºΩÂä®‰ΩúÔºü">
                    <div class="ask-icon"><i class="fas fa-dumbbell"></i></div>
                    <div class="ask-content">
                        <h3>ÂÅ•Â∫∑ÁîüÊ¥ª</h3>
                        <p>Â¶Ç‰ΩïÂú®‰∏ÄÂë®ÂÜÖÂ≠¶‰ºöÂü∫Á°ÄÁëú‰ºΩÂä®‰ΩúÔºü</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
                    </div>
                `;
                chatArea.innerHTML = chatIntroHTML;
                
                // ÈáçÊñ∞ÁªëÂÆöÁ§∫‰æãÈóÆÈ¢ò‰∫ã‰ª∂
                document.querySelectorAll('.example-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const question = item.querySelector('strong').textContent;
                        chatInput.value = question;
                        sendMessage();
                    });
                });
                return;
            }
            
            // Âä†ËΩΩËÅäÂ§©Ê∂àÊÅØ
            chat.messages.forEach(msg => {
                addMessage(msg.content, msg.role === 'user' ? 'user' : 'ai');
                
                // Â¶ÇÊûúÊúâÊÄùËÄÉËøáÁ®ãÔºå‰πüÊ∑ªÂä†ÊòæÁ§∫
                if (msg.thinking && msg.role === 'assistant') {
                    // Âú®Áî®Êà∑Ê∂àÊÅØÂíåAIÂõûÂ§ç‰πãÈó¥ÊèíÂÖ•ÊÄùËÄÉËøáÁ®ã
                    const messageElements = document.querySelectorAll('.message');
                    const aiMessageElement = messageElements[messageElements.length - 1];
                    
                    const thinkingElement = document.createElement('div');
                    thinkingElement.className = 'message ai-message';
                    
                    const timeString = new Date(msg.timestamp).toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
                    
                    thinkingElement.innerHTML = `
                        <div class="message-content">
                            <div class="thinking-process">
                                <strong>ÊÄùËÄÉËøáÁ®ãÔºö</strong><br>
                                ${msg.thinking}
                            </div>
                        </div>
                        <div class="message-time">${timeString}</div>
                    `;
                    
                    // ÊèíÂÖ•Âà∞AIÂõûÂ§çÂâçÈù¢
                    chatArea.insertBefore(thinkingElement, aiMessageElement);
                }
                // ÊÅ¢Â§çÂèçÈ¶àÁä∂ÊÄÅ (Ê∑ªÂä†Âú®Âæ™ÁéØÂÜÖ)
    if (msg.role === 'assistant') {
        const messageElements = document.querySelectorAll('.ai-message');
        const lastMessage = messageElements[messageElements.length - 1];
        const likeBtn = lastMessage.querySelector('.like-btn');
        const dislikeBtn = lastMessage.querySelector('.dislike-btn');
        
        if (msg.feedback === 'like') {
            likeBtn.innerHTML = '<i class="fas fa-thumbs-up"></i>';
        } else if (msg.feedback === 'dislike') {
            dislikeBtn.innerHTML = '<i class="fas fa-thumbs-down"></i>';
        }
    }
            });
        }

        // ËÆæÁΩÆÂºπÁ™ó
        settingsBtn.addEventListener('click', () => {
            modalOverlay.classList.add('show');
        });

        closeModal.addEventListener('click', () => {
            modalOverlay.classList.remove('show');
        });

        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                modalOverlay.classList.remove('show');
            }
        });

        // Ê∑±Ëâ≤Ê®°ÂºèÂàáÊç¢
        darkModeToggle.addEventListener('change', () => {
            document.body.classList.toggle('dark-mode', darkModeToggle.checked);
            localStorage.setItem('darkMode', darkModeToggle.checked);
        });

        // ÁªëÂÆöÁ§∫‰æãÈóÆÈ¢ò‰∫ã‰ª∂
        exampleItems.forEach(item => {
            item.addEventListener('click', () => {
                const question = item.querySelector('strong').textContent;
                chatInput.value = question;
                sendMessage();
            });
        });

        // Â§ÑÁêÜÁßØÂàÜÂÖÖÂÄº
        addCreditsBtn.addEventListener('click', () => {
            creditsModalOverlay.classList.add('show');
        });

        closeCreditsModal.addEventListener('click', () => {
            creditsModalOverlay.classList.remove('show');
        });

        creditsModalOverlay.addEventListener('click', (e) => {
            if (e.target === creditsModalOverlay) {
                creditsModalOverlay.classList.remove('show');
            }
        });

        redeemButton.addEventListener('click', () => {
            const code = redeemCode.value.trim();
            if (code === 'Aq7Rz9TwLk3JqXc5VbNm2OpQr1StUvWxYz8') {
                if (hasRedeemedCode) {
                    redeemMessage.textContent = "ÊÇ®Â∑≤ÁªèÂÖëÊç¢ËøáÁßØÂàÜÔºåÊØèÂè∞ËÆæÂ§á‰ªÖËÉΩÂÖëÊç¢‰∏ÄÊ¨°";
                    redeemMessage.style.color = "#ff3333";
                    redeemMessage.style.display = "block";
                } else {
                    // Â¢ûÂä†ÁßØÂàÜ
                    currentCredits += 1000;
                    saveCreditsToStorage(); // Êñ∞Â¢û
                    updateCreditsDisplay();
                    
                    // ÊòæÁ§∫ÊàêÂäü‰ø°ÊÅØ
                    redeemMessage.textContent = "ÂÖëÊç¢ÊàêÂäüÔºÅÂ∑≤Ê∑ªÂä†1000ÁßØÂàÜ";
                    redeemMessage.style.color = "green";
                    redeemMessage.style.display = "block";
                    
                    // Ê†áËÆ∞‰∏∫Â∑≤ÂÖëÊç¢
                    hasRedeemedCode = true;
                    localStorage.setItem('hasRedeemedCode', 'true');
                    
                    // Á¶ÅÁî®ÂÖëÊç¢ÊåâÈíÆÂíåËæìÂÖ•Ê°Ü
                    redeemButton.disabled = true;
                    redeemCode.disabled = true;
                    
                    // 3ÁßíÂêéÂÖ≥Èó≠ÂºπÁ™ó
                    setTimeout(() => {
                        creditsModalOverlay.classList.remove('show');
                    }, 3000);
                }
            } else {
                redeemMessage.textContent = "ÂÖëÊç¢Á†ÅÊó†ÊïàÔºåËØ∑ÈáçÊñ∞ËæìÂÖ•";
                redeemMessage.style.color = "#ff3333";
                redeemMessage.style.display = "block";
            }
        });

        // ÂàùÂßãÂåñÂ∫îÁî®
        init();
    </script>
</body>
</html>