<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <title>Jork-v3 AIåŠ©æ‰‹</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* å‘½ä»¤é¢æ¿æ ·å¼ */
.command-palette {
    position: absolute;
    bottom: 80px;
    right: 20px;
    background: var(--light-card);
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    width: 200px;
    z-index: 1000;
}

.command-item {
    padding: 10px;
    cursor: pointer;
    transition: background 0.2s;
    display: flex;
    align-items: center;
    gap: 10px;
}

.command-item:hover {
    background: rgba(123,104,238,0.1);
}
        .search-results {
    border-left: 3px solid #4CAF50;
    padding: 15px;
    margin: 10px 0;
    background: rgba(76,175,80,0.05);
    border-radius: 8px;
}

.search-abstract {
    color: #666;
    margin-bottom: 12px;
    line-height: 1.6;
}

.related-results ul {
    padding-left: 20px;
    margin-top: 8px;
}

.related-results li {
    margin-bottom: 6px;
    padding-left: 8px;
}
        /* åŸºæœ¬æ ·å¼ */
    body {
      margin: 0;
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
      background-color: #f5f7fb;
    }
    .header {
      display: flex;
      align-items: center;
      padding: 10px 20px;
      background-color: #fff;
      border-bottom: 1px solid #e0e0e0;
    }
    .left-header {
      display: flex;
      align-items: center;
      flex-shrink: 0;
    }
    .credits {
      margin-left: auto;
      display: flex;
      align-items: center;
    }
    .credits i {
      margin-right: 8px;
      color: #ffc107;
    }
    .credits span {
      margin-right: 10px;
      font-weight: 600;
    }
    .model-select {
      padding: 6px 10px;
      font-size: 0.9em;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      background-color: #f5f7fb;
      cursor: pointer;
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%237b68ee' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 14px;
    }
    .model-select:focus {
      outline: none;
      border-color: #7b68ee;
      box-shadow: 0 0 0 2px rgba(123,104,238,0.2);
    }
        /* é“¾æ¥å®¹å™¨æ ·å¼ */
.footer-links-container {
    padding: 15px 0;
    border-top: 1px solid var(--light-border);
    margin-top: 15px;
}

/* é€šç”¨é“¾æ¥æ ·å¼ */
.footer-links-container a {
    color: var(--light-text);
    text-decoration: none;
    font-size: 0.9em;
    transition: color 0.2s;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 6px 0;
}

.footer-links-container a:hover {
    color: var(--primary-color);
}

/* æ ‡é¢˜æ ·å¼ */
.footer-links-container h4 {
    color: var(--primary-color);
    font-size: 0.95em;
    margin: 15px 0 10px;
    font-weight: 600;
}

/* åˆ†éš”çº¿æ ·å¼ */
.dot-divider {
    color: var(--light-border);
    padding: 0 5px;
    font-weight: bold;
}

/* ä¿¡æ¯é“¾æ¥è¡Œæ ·å¼ */
.info-links {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 5px;
}

/* å¾®ä¿¡å…¬ä¼—å·æ‚¬æµ®æç¤º */
.wechat-link {
    position: relative;
}

.wechat-link:hover::after {
    content: "æ‰«ç å…³æ³¨";
    position: absolute;
    left: 0;
    bottom: 100%;
    background: var(--light-card);
    padding: 6px 10px;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    font-size: 0.8em;
    white-space: nowrap;
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
    .footer-links-container {
        padding: 10px;
    }
    
    .info-links {
        justify-content: center;
    }
}
        .message-content {
    white-space: pre-wrap;
    word-wrap: break-word;
    line-height: 1.6;
}

.message-content p {
    margin: 8px 0;
}
    .message-heading {
        font-size: 1.4rem;
        margin: 15px 0 10px;
        color: var(--primary-color);
        border-bottom: 2px solid rgba(123, 104, 238, 0.2);
        padding-bottom: 5px;
    }

    .message-subheading {
        font-size: 1.2rem;
        margin: 12px 0 8px;
        color: var(--secondary-color);
    }

.thinking-process {
    background: linear-gradient(145deg, rgba(123,104,238,0.08) 0%, rgba(123,104,238,0.03) 100%);
    border: 1px solid var(--primary-color);
    border-radius: 12px;
    padding: 18px 24px;
    margin: 16px 0;
    position: relative;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    counter-reset: thinking-step;
    line-height: 1.7;
}

.thinking-process::before {
    content: "ğŸ’¡";
    position: absolute;
    top: -18px;
    left: 20px;
    background: var(--light-card);
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 1.2em;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.thinking-process strong {
    display: block;
    margin-bottom: 12px;
    font-style: normal;
    color: var(--primary-color);
    font-size: 1.1em;
    padding-bottom: 8px;
    border-bottom: 2px dashed rgba(123,104,238,0.3);
}

.thinking-process ol {
    padding-left: 32px;
    margin: 12px 0;
}

.thinking-process li {
    margin-bottom: 12px;
    position: relative;
    padding-left: 28px;
    transition: all 0.3s ease;
}

.thinking-process li::before {
    content: counter(thinking-step);
    counter-increment: thinking-step;
    position: absolute;
    left: 0;
    top: 2px;
    width: 20px;
    height: 20px;
    background: rgba(123,104,238,0.1);
    border-radius: 50%;
    text-align: center;
    line-height: 20px;
    font-size: 0.9em;
    color: var(--primary-color);
    font-weight: 600;
}

.thinking-process li:hover {
    transform: translateX(8px);
}

body.dark-mode .thinking-process {
    background: linear-gradient(145deg, rgba(123,104,238,0.15) 0%, rgba(123,104,238,0.05) 100%);
    border-color: rgba(123,104,238,0.5);
}

body.dark-mode .thinking-process::before {
    background: var(--dark-card);
    color: #7b68ee;
}
        :root {
            --primary-color: #7b68ee;
            --secondary-color: #5d4aee;
            --light-bg: #f5f7fb;
            --dark-bg: #1a1a2e;
            --light-sidebar: #eef1f8;
            --dark-sidebar: #242438;
            --light-text: #333;
            --dark-text: #e0e0e0;
            --light-card: #fff;
            --dark-card: #2a2a42;
            --light-border: #e0e0e0;
            --dark-border: #3f3f5a;
        }

        â–ª {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--light-text);
            transition: background-color 0.3s, color 0.3s;
            overflow: hidden;
            height: 100vh;
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .container {
            display: flex;
            height: 100vh;
        }

        /* ä¾§è¾¹æ æ ·å¼ */
        .sidebar {
            width: 280px;
            background-color: var(--light-sidebar);
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--light-border);
            transition: all 0.3s, width 0.3s;
            position: relative;
            z-index: 10;
        }

        body.dark-mode .sidebar {
            background-color: var(--dark-sidebar);
            border-right: 1px solid var(--dark-border);
        }

        .sidebar-resizer {
            position: absolute;
            right: -5px;
            top: 0;
            width: 10px;
            height: 100%;
            cursor: col-resize;
            z-index: 11;
        }

        .new-chat-btn {
            margin: 15px;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }

        .new-chat-btn:hover {
            background-color: var(--secondary-color);
        }

        .new-chat-btn i {
            margin-right: 8px;
        }

        .chat-history {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .history-item {
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-item:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .history-item:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .history-item.active {
            background-color: rgba(123, 104, 238, 0.1);
        }

        .sidebar-footer {
            padding: 15px;
            border-top: 1px solid var(--light-border);
        }

        body.dark-mode .sidebar-footer {
            border-top: 1px solid var(--dark-border);
        }

        .settings-btn {
            padding: 10px;
            width: 100%;
            background: none;
            border: 1px solid var(--light-border);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            color: inherit;
            transition: background-color 0.2s;
        }

        body.dark-mode .settings-btn {
            border: 1px solid var(--dark-border);
        }

        .settings-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .settings-btn:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .settings-btn i {
            margin-right: 8px;
        }

        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }

        .header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            border-bottom: 1px solid var(--light-border);
            background-color: var(--light-card);
        }

        body.dark-mode .header {
            background-color: var(--dark-card);
            border-bottom: 1px solid var(--dark-border);
        }

        .credits {
            display: flex;
            align-items: center;
            font-weight: 600;
        }

        .credits i {
            margin-right: 8px;
            color: #ffc107;
        }

        .add-credits-btn {
            margin-left: 10px;
            background: none;
            border: none;
            color: #ffc107;
            cursor: pointer;
            font-size: 1.2rem;
            transition: transform 0.2s;
        }

        .add-credits-btn:hover {
            transform: scale(1.2);
        }

        /* æ€è€ƒè¿‡ç¨‹å¯è§†åŒ– */
        .thinking-process {
            background-color: var(--light-card);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid var(--primary-color);
            font-style: italic;
            color: #666;
        }

        body.dark-mode .thinking-process {
            background-color: var(--dark-card);
            color: #aaa;
        }

        /* èŠå¤©åŒºåŸŸ */
        .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .chat-intro {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 40px auto;
            max-width: 600px;
            text-align: center;
        }

        .chat-intro h1 {
            margin-bottom: 15px;
            font-size: 2rem;
        }

        .chat-intro p {
            color: #666;
            margin-bottom: 25px;
        }

        body.dark-mode .chat-intro p {
            color: #aaa;
        }

        .example-questions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            width: 100%;
        }

        .example-item {
            padding: 15px;
            background-color: var(--light-card);
            border-radius: 8px;
            border: 1px solid var(--light-border);
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .example-item {
            background-color: var(--dark-card);
            border: 1px solid var(--dark-border);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .example-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .example-item:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .message {
            max-width: 80%;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        .message.user-message {
            align-self: flex-end;
        }

        .message.ai-message {
            align-self: flex-start;
        }

        

        .user-message .message-content {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 10px;
        }

        .ai-message .message-content {
            background-color: var(--light-card);
            border-radius: 10px 10px 10px 0;
        }

        body.dark-mode .ai-message .message-content {
            background-color: var(--dark-card);
        }

        .message-time {
            font-size: 0.8rem;
            color: #888;
            margin-top: 5px;
            align-self: flex-end;
        }

        .ai-message .message-time {
            align-self: flex-start;
        }

        body.dark-mode .message-time {
            color: #aaa;
        }

        /* ä»£ç å—æ ·å¼ */
        .code-block {
    background: var(--dark-bg);
    border-radius: 8px;
    margin: 15px 0;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.code-header {
    background: rgba(255,255,255,0.1);
    padding: 8px 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.code-content {
    padding: 12px;
    font-family: 'Fira Code', monospace;
    font-size: 0.9em;
    line-height: 1.5;
    tab-size: 4;
}

        body.dark-mode .code-block {
            background-color: #2d2d3a;
        }

        body.dark-mode .code-header {
            background-color: #35354a;
        }

        /* è¡¨æ ¼æ ·å¼ */
        .table-container {
            margin: 10px 0;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        th, td {
            border: 1px solid var(--light-border);
            padding: 8px 12px;
            text-align: left;
        }

        body.dark-mode th, body.dark-mode td {
            border: 1px solid var(--dark-border);
        }

        th {
            background-color: #f0f0f0;
            font-weight: 600;
        }

        body.dark-mode th {
            background-color: #3a3a55;
        }

        /* èŠå¤©è¾“å…¥åŒºåŸŸ */
        .chat-input-container {
            padding: 15px 20px;
            background-color: var(--light-card);
            border-top: 1px solid var(--light-border);
        }

        body.dark-mode .chat-input-container {
            background-color: var(--dark-card);
            border-top: 1px solid var(--dark-border);
        }

        .chat-input-wrapper {
            display: flex;
            position: relative;
        }

        .chat-input {
            flex: 1;
            padding: 15px;
            padding-right: 100px;
            border-radius: 10px;
            border: 1px solid var(--light-border);
            outline: none;
            resize: none;
            min-height: 60px;
            max-height: 200px;
            background-color: var(--light-bg);
            transition: border-color 0.3s;
            overflow-y: auto;
        }

        body.dark-mode .chat-input {
            background-color: var(--dark-bg);
            border: 1px solid var(--dark-border);
            color: var(--dark-text);
        }

        .chat-input:focus {
            border-color: var(--primary-color);
        }

        .input-buttons {
            position: absolute;
            right: 10px;
            bottom: 10px;
            display: flex;
            gap: 8px;
        }

        .input-button {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            cursor: pointer;
            color: #777;
            transition: color 0.2s, background-color 0.2s;
        }

        .input-button:hover {
            color: var(--primary-color);
            background-color: rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .input-button:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .input-button.active {
            color: var(--primary-color);
        }

        .send-button {
            background-color: var(--primary-color);
            color: white;
        }

        .send-button:hover {
            background-color: var(--secondary-color);
            color: white;
        }

        .loading-dots {
            display: inline-flex;
            align-items: center;
        }

        .dot {
            width: 8px;
            height: 8px;
            background-color: currentColor;
            border-radius: 50%;
            margin: 0 2px;
            animation: dot-pulse 1.5s infinite ease-in-out;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes dot-pulse {
            0%, 100% {
                transform: scale(0.8);
                opacity: 0.5;
            }
            50% {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        /* è®¾ç½®å¼¹çª— */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            width: 500px;
            background-color: var(--light-card);
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-20px);
            transition: transform 0.3s;
            overflow: hidden;
        }

        body.dark-mode .modal {
            background-color: var(--dark-card);
        }

        .modal-overlay.show .modal {
            transform: translateY(0);
        }

        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        body.dark-mode .modal-header {
            border-bottom: 1px solid var(--dark-border);
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: inherit;
        }

        .modal-body {
            padding: 20px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .settings-section {
            margin-bottom: 25px;
        }

        .settings-section:last-child {
            margin-bottom: 0;
        }

        .settings-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .settings-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        .user-details {
            flex: 1;
        }

        .user-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .user-status {
            display: inline-block;
            padding: 3px 8px;
            background-color: #4caf50;
            color: white;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        .privacy-link {
            color: var(--primary-color);
            text-decoration: none;
        }

        .privacy-link:hover {
            text-decoration: underline;
        }

        /* ç§¯åˆ†å…‘æ¢å¼¹çª— */
        .credits-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }

        .credits-modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .credits-modal {
            width: 400px;
            background-color: var(--light-card);
            border-radius: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
            transform: translateY(-20px);
            transition: transform 0.3s;
            overflow: hidden;
        }

        body.dark-mode .credits-modal {
            background-color: var(--dark-card);
        }

        .credits-modal-overlay.show .credits-modal {
            transform: translateY(0);
        }

        .credits-modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--light-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        body.dark-mode .credits-modal-header {
            border-bottom: 1px solid var(--dark-border);
        }

        .credits-modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }

        .close-credits-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: inherit;
        }

        .credits-modal-body {
            padding: 20px;
        }

        .redeem-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .redeem-input {
            padding: 12px;
            border-radius: 8px;
            border: 1px solid var(--light-border);
            background-color: var(--light-bg);
            font-size: 1rem;
        }

        body.dark-mode .redeem-input {
            background-color: var(--dark-bg);
            border: 1px solid var(--dark-border);
            color: var(--dark-text);
        }

        .redeem-button {
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .redeem-button:hover {
            background-color: var(--secondary-color);
        }

        .redeem-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                height: 100%;
            }

            .sidebar.show {
                left: 0;
            }

            .sidebar-toggle {
                display: block;
            }

            .example-questions {
                grid-template-columns: 1fr;
            }
        }
        .model-selection-container {
  display: flex;
  gap: 10px;
  margin-bottom: 8px;
}

.model-option {
  cursor: pointer;
  padding: 8px 16px;
  border: 2px solid var(--light-border);
  border-radius: 8px;
  transition: background-color 0.2s, border-color 0.2s;
}

.model-option:hover {
  border-color: var(--primary-color);
}

.model-option.active {
  background-color: var(--primary-color);
  color: #fff;
  border-color: var(--primary-color);
}
.chat-input-tips {
  font-size: 0.8rem;
  color: #888;
  text-align: center;
  margin-top: 5px;
}
.featured-sections {
    display: flex;
    flex-direction: column;
    gap: 20px;
    width: 100%;
    margin-top: 20px;
}

.section-container {
    background-color: var(--light-card);
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.05);
    overflow: hidden;
    transition: transform 0.3s, box-shadow 0.3s;
}

body.dark-mode .section-container {
    background-color: var(--dark-card);
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
}

.section-header {
    padding: 15px 20px;
    background: linear-gradient(135deg, rgba(123,104,238,0.1) 0%, rgba(123,104,238,0.05) 100%);
    display: flex;
    align-items: center;
    gap: 10px;
}

.section-header i {
    color: var(--primary-color);
    font-size: 1.2rem;
}

.section-header h2 {
    font-size: 1.2rem;
    margin: 0;
    color: var(--light-text);
    font-weight: 600;
}

body.dark-mode .section-header h2 {
    color: var(--dark-text);
}

/* Hot searches styling */
.search-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    padding: 15px;
}

.search-item {
    background-color: rgba(123,104,238,0.05);
    border: 1px solid rgba(123,104,238,0.1);
    border-radius: 8px;
    padding: 12px 15px;
    cursor: pointer;
    transition: all 0.2s;
    text-align: center;
}

.search-item:hover {
    background-color: rgba(123,104,238,0.1);
    transform: translateY(-2px);
}

.search-item span {
    font-size: 0.9rem;
    color: var(--light-text);
    font-weight: 500;
}

body.dark-mode .search-item span {
    color: var(--dark-text);
}

/* Try asking me styling */
.ask-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    padding: 15px;
}

.ask-item {
    display: flex;
    align-items: center;
    background-color: rgba(123,104,238,0.05);
    border: 1px solid rgba(123,104,238,0.1);
    border-radius: 10px;
    padding: 15px;
    cursor: pointer;
    transition: all 0.2s;
}

.ask-item:hover {
    background-color: rgba(123,104,238,0.1);
    transform: translateY(-2px);
}

.ask-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-right: 15px;
    flex-shrink: 0;
}

.ask-icon i {
    color: white;
    font-size: 1rem;
}

.ask-content {
    flex: 1;
}

.ask-content h3 {
    font-size: 0.95rem;
    margin: 0 0 5px 0;
    color: var(--primary-color);
    font-weight: 600;
}

.ask-content p {
    font-size: 0.85rem;
    margin: 0;
    color: var(--light-text);
}

body.dark-mode .ask-content p {
    color: var(--dark-text);
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .search-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .ask-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .search-grid {
        grid-template-columns: 1fr;
    }
}
/* åœ¨åŸæœ‰æ ·å¼ä¸­æ·»åŠ  */
.message-actions {
    display: flex;
    gap: 8px;
    margin-top: 8px;
    opacity: 0;
    transition: opacity 0.2s;
}

.message:hover .message-actions {
    opacity: 1;
}

.action-btn {
    background: none;
    border: none;
    cursor: pointer;
    color: var(--light-text);
    padding: 4px;
    font-size: 0.9em;
    transition: color 0.2s;
}

.action-btn:hover {
    color: var(--primary-color);
}

body.dark-mode .action-btn {
    color: var(--dark-text);
}

.liked {
    color: #4CAF50 !important;
}

.disliked {
    color: #F44336 !important;
}
.search-status {
    display: none;
    align-items: center;
    gap: 8px;
    color: var(--primary-color);
    font-size: 0.9rem;
    padding: 8px 12px;
    background: rgba(123,104,238,0.1);
    border-radius: 8px;
    margin-bottom: 10px;
}

.search-status.active {
    display: flex;
}
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¾§è¾¹æ  -->
        <div class="sidebar">
            <div class="sidebar-resizer"></div>
            <button class="new-chat-btn"><i class="fas fa-plus"></i> æ–°å»ºèŠå¤©</button>
            <div class="chat-history">
                <!-- èŠå¤©å†å²å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
            <div class="sidebar-footer">
                <button class="settings-btn"><i class="fas fa-cog"></i> è®¾ç½®</button>
            </div>
            <div class="sidebar-header">
                <button class="toggle-sidebar-btn"><i class="fas fa-chevron-left"></i></button>
            </div>
            
            <style>
                .sidebar-header {
                    padding: 10px;
                    border-bottom: 1px solid var(--light-border);
                    display: flex;
                    justify-content: flex-end;
                }
            
                .toggle-sidebar-btn {
                    background: none;
                    border: none;
                    color: var(--primary-color);
                    cursor: pointer;
                    padding: 5px;
                }
            
                @media (min-width: 769px) {
                    .sidebar.collapsed {
                        width: 50px !important;
                        overflow: hidden;
                    }
            
                    .sidebar.collapsed .toggle-sidebar-btn i {
                        transform: rotate(180deg);
                    }
            
                    .sidebar.collapsed .new-chat-btn,
                    .sidebar.collapsed .chat-history,
                    .sidebar.collapsed .settings-btn span {
                        display: none;
                    }
                }
            </style>
        </div>

        <!-- ä¸»å†…å®¹åŒºåŸŸ -->
        <div class="main-content">
            <div class="header">
                <!-- æ¨¡å‹é€‰æ‹©æ”¾ç½®åœ¨æœ€å·¦è¾¹ -->
                <div class="left-header">
                  <select class="model-select" id="modelSelect">
                    <option value="Jork-3-Epic" data-cost="100">Jork-3-Epic (100ç§¯åˆ†)</option>
                    <option value="Jork-3-Canto" data-cost="60">Jork-3-Canto (60ç§¯åˆ†)</option>
                    <option value="Jork-3-Tanka" data-cost="30">Jork-3-Tanka (30ç§¯åˆ†)</option>
                    <option value="Claude-3.5-Sonnet" data-cost="300">Claude-3.5-Sonnet (300ç§¯åˆ†)</option>
                    <option value="Claude-3.7-Sonnet" data-cost="800">Claude-3.7-Sonnet (800ç§¯åˆ†)</option>
                  </select>
                </div>
                <!-- ç§¯åˆ†æ˜¾ç¤ºæ”¾åœ¨å³è¾¹ -->
                <div class="credits">
                  <i class="fas fa-coins"></i>
                  <span>ç§¯åˆ†ï¼š3000</span>
                  <button class="add-credits-btn" title="æ·»åŠ ç§¯åˆ†"><i class="fas fa-plus-circle"></i></button>
                </div>
            </div>
            <!-- èŠå¤©åŒºåŸŸ -->
            <div class="chat-area">
                <!-- Replace the existing chat-intro div with this new structure -->
<div class="chat-intro">
    <h1>ä¸‹åˆå¥½ï¼Œæˆ‘æ˜¯ JorkAI</h1>
    <p>æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</p>
    
    <div class="featured-sections">
        <!-- Hot searches section -->
        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-fire"></i>
                <h2>çƒ­æœ</h2>
            </div>
            <div class="search-grid">
                <div class="search-item" data-query="ChatGPTå’ŒClaudeæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">
                    <span>ChatGPTå’ŒClaudeæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="å¦‚ä½•æé«˜è‹±è¯­å£è¯­æ°´å¹³ï¼Ÿ">
                    <span>å¦‚ä½•æé«˜è‹±è¯­å£è¯­æ°´å¹³ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="Pythonå’ŒJavaScriptå“ªä¸ªæ›´é€‚åˆåˆå­¦è€…ï¼Ÿ">
                    <span>Pythonå’ŒJavaScriptå“ªä¸ªæ›´é€‚åˆåˆå­¦è€…ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="äººå·¥æ™ºèƒ½ä¼šå–ä»£å“ªäº›å·¥ä½œï¼Ÿ">
                    <span>äººå·¥æ™ºèƒ½ä¼šå–ä»£å“ªäº›å·¥ä½œï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="å¦‚ä½•æœ‰æ•ˆç®¡ç†æ—¶é—´ï¼Ÿ">
                    <span>å¦‚ä½•æœ‰æ•ˆç®¡ç†æ—¶é—´ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="æå˜‰è¯šå–æ‰43ä¸ªæ¸¯å£å¯¹ä¸­å›½çš„å½±å“">
                    <span>æå˜‰è¯šå–æ‰43ä¸ªæ¸¯å£</span>
                </div>
            </div>
        </div>
        
        <!-- Try asking me section -->
        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-question-circle"></i>
                <h2>è¯•ç€é—®æˆ‘</h2>
            </div>
            <div class="ask-grid">
                <div class="ask-item" data-query="å¸®æˆ‘å†™ä¸€ç¯‡å…³äºç¯ä¿çš„æ¼”è®²ç¨¿">
                    <div class="ask-icon"><i class="fas fa-pencil-alt"></i></div>
                    <div class="ask-content">
                        <h3>å†™ä½œåŠ©æ‰‹</h3>
                        <p>å¸®æˆ‘å†™ä¸€ç¯‡å…³äºç¯ä¿çš„æ¼”è®²ç¨¿</p>
                    </div>
                </div>
                <div class="ask-item" data-query="è§£é‡Šä¸€ä¸‹åŒºå—é“¾æŠ€æœ¯çš„å·¥ä½œåŸç†">
                    <div class="ask-icon"><i class="fas fa-lightbulb"></i></div>
                    <div class="ask-content">
                        <h3>çŸ¥è¯†è§£ç­”</h3>
                        <p>è§£é‡Šä¸€ä¸‹åŒºå—é“¾æŠ€æœ¯çš„å·¥ä½œåŸç†</p>
                    </div>
                </div>
                <div class="ask-item" data-query="è®¾è®¡ä¸€ä¸ªPythonçˆ¬è™«è·å–æ–°é—»æ ‡é¢˜">
                    <div class="ask-icon"><i class="fas fa-code"></i></div>
                    <div class="ask-content">
                        <h3>ç¼–ç¨‹å¸®åŠ©</h3>
                        <p>è®¾è®¡ä¸€ä¸ªPythonçˆ¬è™«è·å–æ–°é—»æ ‡é¢˜</p>
                    </div>
                </div>
                <div class="ask-item" data-query="å¦‚ä½•åœ¨ä¸€å‘¨å†…å­¦ä¼šåŸºç¡€ç‘œä¼½åŠ¨ä½œï¼Ÿ">
                    <div class="ask-icon"><i class="fas fa-dumbbell"></i></div>
                    <div class="ask-content">
                        <h3>å¥åº·ç”Ÿæ´»</h3>
                        <p>å¦‚ä½•åœ¨ä¸€å‘¨å†…å­¦ä¼šåŸºç¡€ç‘œä¼½åŠ¨ä½œï¼Ÿ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add these styles to your existing CSS -->
                <!-- èŠå¤©æ¶ˆæ¯å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
            </div>
              

<!-- ä¿®æ”¹åçš„èŠå¤©è¾“å…¥åŒºåŸŸ -->
<div class="chat-input-container">
    <div class="search-status">
        <i class="fas fa-search"></i>
        <span>è”ç½‘æœç´¢æ¨¡å¼å·²æ¿€æ´»</span>
    </div>
  
    <!-- è¾“å…¥æ¡†å’ŒæŒ‰é’®éƒ¨åˆ†ä¿æŒä¸å˜ -->
    <div class="chat-input-wrapper">
      <textarea class="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." rows="1"></textarea>
      <div class="input-buttons">
        <button class="input-button thinking-button" title="æ·±åº¦æ€è€ƒ">
          <i class="fas fa-lightbulb"></i>
        </button>
        <button class="input-button search-button" title="è”ç½‘æœç´¢">
          <i class="fas fa-search"></i>
        </button>
        <button class="input-button upload-button" title="ä¸Šä¼ é™„ä»¶">
          <i class="fas fa-paperclip"></i>
        </button>
        <button class="input-button voice-button" title="è¯­éŸ³è¾“å…¥">
            <i class="fas fa-microphone"></i>
        </button>

        <button class="input-button send-button" title="å‘é€">
          <i class="fas fa-paper-plane"></i>
        </button>
      </div>
      <!-- æ·»åŠ è¯­éŸ³çŠ¶æ€æç¤º -->
<div class="voice-status">
    <i class="fas fa-microphone"></i>
    <span>æ­£åœ¨è†å¬...</span>
</div>
    </div>
  </div>
  
  <style>
  /* æ–°å¢æ ·å¼ */
  .chat-input-container {
    display: flex;
    align-items: center; /* å‚ç›´å±…ä¸­ */
    gap: 10px; /* å…ƒç´ ä¹‹é—´çš„é—´è· */
  }
  
  .model-selection {
    flex-shrink: 0; /* é˜²æ­¢é€‰æ‹©æ¡†è¢«å‹ç¼© */
  }
  
  .chat-input-wrapper {
    flex: 1; /* è¾“å…¥æ¡†å æ®å‰©ä½™ç©ºé—´ */
  }
  
  /* è°ƒæ•´é€‰æ‹©æ¡†æ ·å¼ */
  .model-select {
    width: 150px; /* è°ƒæ•´å®½åº¦ */
    padding: 6px 10px; /* è°ƒæ•´å†…è¾¹è· */
    border: 2px solid var(--light-border);
    border-radius: 8px;
    background-color: var(--light-bg);
    color: var(--light-text);
    font-size: 0.85em; /* è°ƒæ•´å­—ä½“å¤§å° */
    cursor: pointer;
    appearance: none;
    -webkit-appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%237b68ee' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 8px center; /* è°ƒæ•´ç®­å¤´ä½ç½® */
    background-size: 14px; /* è°ƒæ•´ç®­å¤´å¤§å° */
    transition: border-color 0.3s;
  }
  
  body.dark-mode .model-select {
    background-color: var(--dark-bg);
    border-color: var(--dark-border);
    color: var(--dark-text);
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23aaa' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
  }
  
  .model-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(123, 104, 238, 0.2);
  }
  
  /* è°ƒæ•´æç¤ºä¿¡æ¯æ ·å¼ */
  .chat-input-tips {
    width: 100%;
    text-align: center;
    margin-top: 5px;
    font-size: 0.8rem;
    color: #888;
  }
  </style>

    <!-- è®¾ç½®å¼¹çª— -->
    <div class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">è®¾ç½®</h3>
                <button class="close-modal">&times;</button>
            </div>
            <!-- æ–°å¢é“¾æ¥åŒºå— -->
        
            <div class="modal-body">
                <div class="settings-section">
                    <h4 class="settings-title">è´¦æˆ·ä¿¡æ¯</h4>
                    <div class="settings-content">
                        <div class="user-info">
                            <div class="user-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="user-details">
                                <div class="user-name">ç”¨æˆ·001</div>
                                <div class="user-status">ä¼šå‘˜</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <h4 class="settings-title">ç•Œé¢è®¾ç½®</h4>
                    <div class="settings-content">
                        <div class="switch-container">
                            <span>æ·±è‰²æ¨¡å¼</span>
                            <label class="switch">
                                <input type="checkbox" id="darkModeToggle">
                                <span class="slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Add this new section to the modal-body in your settings modal -->
<div class="settings-section">
    <h4 class="settings-title">API æ¥å…¥è®¾ç½®</h4>
    <div class="settings-content">
        <div class="api-input-container">
            <label for="apiKeyInput">API Key</label>
            <div class="api-input-wrapper">
                <input type="password" id="apiKeyInput" class="api-input" placeholder="è¯·è¾“å…¥æ‚¨çš„APIå¯†é’¥">
                <button id="toggleApiKey" class="toggle-api-key">
                    <i class="far fa-eye"></i>
                </button>
            </div>
        </div>
        <div class="api-input-container">
            <label for="apiEndpointInput">API ç«¯ç‚¹</label>
            <input type="text" id="apiEndpointInput" class="api-input" placeholder="https://api.example.com/v1/chat/completions">
        </div>
        <div class="api-provider-dropdown">
            <label for="apiProviderSelect">API æä¾›å•†</label>
            <select id="apiProviderSelect" class="api-select">
                <option value="custom">è‡ªå®šä¹‰</option>
                <option value="openai">OpenAI</option>
                <option value="anthropic">Anthropic</option>
                <option value="deepseek">DeepSeek</option>
                <option value="qianfan">ç™¾åº¦åƒå¸†</option>
                <option value="xinghuo">æ˜Ÿç«è®¤çŸ¥</option>
            </select>
        </div>
        <div class="api-actions">
            <button id="saveApiSettings" class="api-save-btn">ä¿å­˜è®¾ç½®</button>
            <button id="testApiConnection" class="api-test-btn">æµ‹è¯•è¿æ¥</button>
        </div>
        <div id="apiStatus" class="api-status"></div>
    </div>
</div>

<!-- Add these styles to your existing CSS -->
<style>
.api-input-container {
    margin-bottom: 15px;
}

.api-input-container label {
    display: block;
    margin-bottom: 6px;
    font-size: 0.9rem;
    color: var(--light-text);
}

body.dark-mode .api-input-container label {
    color: var(--dark-text);
}

.api-input {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid var(--light-border);
    background-color: var(--light-bg);
    font-size: 0.9rem;
    transition: border-color 0.2s, box-shadow 0.2s;
}

body.dark-mode .api-input {
    background-color: var(--dark-bg);
    border-color: var(--dark-border);
    color: var(--dark-text);
}

.api-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(123, 104, 238, 0.2);
}

.api-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.toggle-api-key {
    position: absolute;
    right: 10px;
    background: none;
    border: none;
    color: #888;
    cursor: pointer;
    padding: 5px;
    font-size: 1rem;
    transition: color 0.2s;
}

.toggle-api-key:hover {
    color: var(--primary-color);
}

.api-provider-dropdown {
    margin-bottom: 15px;
}

.api-select {
    width: 100%;
    padding: 10px 12px;
    border-radius: 8px;
    border: 1px solid var(--light-border);
    background-color: var(--light-bg);
    font-size: 0.9rem;
    appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%237b68ee' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 14px;
}

body.dark-mode .api-select {
    background-color: var(--dark-bg);
    border-color: var(--dark-border);
    color: var(--dark-text);
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23aaa' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
}

.api-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(123, 104, 238, 0.2);
}

.api-actions {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
}

.api-save-btn, .api-test-btn {
    padding: 8px 16px;
    border-radius: 8px;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.2s;
}

.api-save-btn {
    background-color: var(--primary-color);
    color: white;
    border: none;
    flex: 1;
}

.api-save-btn:hover {
    background-color: var(--secondary-color);
}

.api-test-btn {
    background-color: transparent;
    color: var(--primary-color);
    border: 1px solid var(--primary-color);
}

body.dark-mode .api-test-btn {
    color: var(--primary-color);
}

.api-test-btn:hover {
    background-color: rgba(123, 104, 238, 0.1);
}

.api-status {
    font-size: 0.9rem;
    padding: 8px 0;
    text-align: center;
    display: none;
}

.api-status.success {
    color: #4CAF50;
    display: block;
}

.api-status.error {
    color: #F44336;
    display: block;
}
</style>

                <div class="settings-section">
                    <h4 class="settings-title">éšç§ä¸åè®®</h4>
                    <div class="settings-content">
                        <a href="yinsi.html" class="privacy-link">éšç§åè®®</a>
                        <a href="juanqian.html" class="privacy-link">æ”¯æŒæˆ‘ä»¬</a>
                        <a href="shuomingshu.html" class="privacy-link">å¦‚ä½•ä½¿ç”¨</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç§¯åˆ†å…‘æ¢å¼¹çª— -->
    <div class="credits-modal-overlay">
        <div class="credits-modal">
            <div class="credits-modal-header">
                <h3 class="credits-modal-title">ç§¯åˆ†å…‘æ¢</h3>
                <button class="close-credits-modal">&times;</button>
            </div>
            <div class="credits-modal-body">
                <div class="redeem-form">
                    <input type="text" class="redeem-input" placeholder="è¯·è¾“å…¥å…‘æ¢ç " id="redeemCode">
                    <button class="redeem-button" id="redeemButton">å…‘æ¢ç§¯åˆ†</button>
                    <div id="redeemMessage" style="color: green; text-align: center; display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡ä»¶ä¸Šä¼ éšè—è¾“å…¥ -->
    <input type="file" id="file-upload" style="display: none">

    <script>
        // è·å–DOMå…ƒç´ 
        const modelSelect = document.getElementById('modelSelect'); // è·å–ä¸‹æ‹‰èœå•
        const sidebar = document.querySelector('.sidebar');
        const sidebarResizer = document.querySelector('.sidebar-resizer');
        const newChatBtn = document.querySelector('.new-chat-btn');
        const chatArea = document.querySelector('.chat-area');
        const chatInput = document.querySelector('.chat-input');
        const sendButton = document.querySelector('.send-button');
        const thinkingButton = document.querySelector('.thinking-button');
        const searchButton = document.querySelector('.search-button');
        const uploadButton = document.querySelector('.upload-button');
        const fileUpload = document.getElementById('file-upload');
        const settingsBtn = document.querySelector('.settings-btn');
        const modalOverlay = document.querySelector('.modal-overlay');
        const closeModal = document.querySelector('.close-modal');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const exampleItems = document.querySelectorAll('.example-item');
        const creditDisplay = document.querySelector('.credits span');
        const addCreditsBtn = document.querySelector('.add-credits-btn');
        const creditsModalOverlay = document.querySelector('.credits-modal-overlay');
        const closeCreditsModal = document.querySelector('.close-credits-modal');
        const redeemButton = document.getElementById('redeemButton');
        const redeemCode = document.getElementById('redeemCode');
        const redeemMessage = document.getElementById('redeemMessage');
        
        // çŠ¶æ€å˜é‡
        let isThinking = false;
        let isSearching = false;
        let currentCredits = localStorage.getItem('jorkCredits') 
                     ? parseInt(localStorage.getItem('jorkCredits')) 
                     : 3000; // é»˜è®¤ç§¯åˆ†
        let chatHistory = [];
        let currentChatId = null;
        let isTyping = false;
        let hasRedeemedCode = localStorage.getItem('hasRedeemedCode') === 'true';


            // åœ¨JavaScriptéƒ¨åˆ†æ·»åŠ 
            const toggleSidebarBtn = document.querySelector('.toggle-sidebar-btn');
            toggleSidebarBtn.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
            });

        // è¯­éŸ³è¯†åˆ«é€»è¾‘
let recognition;
if ('webkitSpeechRecognition' in window) {
    recognition = new webkitSpeechRecognition();
    recognition.continuous = false;
    recognition.interimResults = true;

    document.querySelector('.voice-button').addEventListener('click', () => {
        recognition.start();
        document.querySelector('.voice-status').style.display = 'flex';
    });

    recognition.onresult = (e) => {
        const transcript = Array.from(e.results)
            .map(result => result[0].transcript)
            .join('');
        chatInput.value = transcript;
    };

    recognition.onerror = () => {
        document.querySelector('.voice-status').style.display = 'none';
    };
} else {
    document.querySelector('.voice-button').style.display = 'none';
}

// ç›‘å¬è¾“å…¥äº‹ä»¶
chatInput.addEventListener('keyup', (e) => {
    if (e.key === '/') {
        showCommandPalette();
    }
});

// å‘½ä»¤é¢æ¿
function showCommandPalette() {
    const commands = [
        {icon: 'fa-language', name: 'ç¿»è¯‘', prompt: 'å°†ä»¥ä¸‹å†…å®¹ç¿»è¯‘æˆè‹±æ–‡ï¼š'},
        {icon: 'fa-code', name: 'ä¼˜åŒ–ä»£ç ', prompt: 'ä¼˜åŒ–è¿™æ®µä»£ç çš„å¯è¯»æ€§ï¼š'},
        {icon: 'fa-file-alt', name: 'æ€»ç»“', prompt: 'ç”¨ä¸‰ç‚¹æ€»ç»“ä»¥ä¸‹å†…å®¹ï¼š'}
    ];

    const palette = `<div class="command-palette">
        ${commands.map(cmd => `
            <div class="command-item" data-prompt="${cmd.prompt}">
                <i class="fas ${cmd.icon}"></i>${cmd.name}
            </div>
        `).join('')}
    </div>`;

    // æ’å…¥åˆ°è¾“å…¥æ¡†ä¸‹æ–¹å¹¶å¤„ç†ç‚¹å‡»
    document.body.insertAdjacentHTML('beforeend', palette);
    document.querySelectorAll('.command-item').forEach(item => {
        item.addEventListener('click', () => {
            chatInput.value = item.dataset.prompt;
            document.querySelector('.command-palette').remove();
        });
    });
}

            function saveCreditsToStorage() {
    try {
        localStorage.setItem('jorkCredits', currentCredits.toString());
    } catch (e) {
        console.error('ç§¯åˆ†å­˜å‚¨å¤±è´¥:', e);
        // å¤„ç†å­˜å‚¨ç©ºé—´ä¸è¶³çš„æƒ…å†µ
        if (e.name === 'QuotaExceededError') {
            alert('æœ¬åœ°å­˜å‚¨ç©ºé—´ä¸è¶³ï¼Œç§¯åˆ†å°†æš‚æ—¶ä¿å­˜åœ¨å†…å­˜ä¸­');
        }
    }
}

function initClickableItems() {
    // Set up click handlers for hot searches
    document.querySelectorAll('.search-item').forEach(item => {
        item.addEventListener('click', () => {
            const query = item.dataset.query;
            chatInput.value = query;
            sendMessage();
        });
    });
    
    // Set up click handlers for "try asking me" items
    document.querySelectorAll('.ask-item').forEach(item => {
        item.addEventListener('click', () => {
            const query = item.dataset.query;
            chatInput.value = query;
            sendMessage();
        });
    });
}

// çƒ­æœç‚¹å‡»äº‹ä»¶
document.querySelectorAll('.search-item').forEach(item => {
    item.addEventListener('click', () => {
        const query = item.dataset.query;
        chatInput.value = query;
        sendMessage();
    });
});

// å›¾ç‰‡ç”Ÿæˆç‚¹å‡»äº‹ä»¶
document.querySelectorAll('.image-item').forEach(item => {
    item.addEventListener('click', () => {
        const prompt = item.dataset.prompt;
        chatInput.value = `/generate ${prompt}`;
        sendMessage();
    });
});

// æ·»åŠ è¿™ä¸ªå‡½æ•° â†“â†“â†“
function getSelectedModelCost() {
  const selectedOption = modelSelect.options[modelSelect.selectedIndex];
  return parseInt(selectedOption.dataset.cost);
}
            // åˆå§‹åŒ–å‡½æ•°
        function init() {
            // æ£€æŸ¥æœ¬åœ°å­˜å‚¨ä¸­çš„æ·±è‰²æ¨¡å¼è®¾ç½®
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                darkModeToggle.checked = true;
            }
            
            // åŠ è½½èŠå¤©å†å²
            loadChatHistory();
            
            // åˆå§‹åŒ–å½“å‰èŠå¤©
            currentChatId = 'chat_' + Date.now();
            chatHistory.push({
                id: currentChatId,
                title: 'æ–°çš„èŠå¤©',
                messages: []
            });
            saveChatHistory();
            updateChatHistoryUI();
            
            // æ ¹æ®æ—¶é—´è°ƒæ•´é—®å€™è¯­
            updateGreeting();
            
            // è‡ªåŠ¨è°ƒæ•´è¾“å…¥æ¡†é«˜åº¦
            chatInput.addEventListener('input', autoResizeTextarea);
            
            // æ£€æŸ¥æ˜¯å¦å·²ç»å…‘æ¢è¿‡ç§¯åˆ†ç 
            if (hasRedeemedCode) {
                redeemButton.disabled = true;
                redeemCode.disabled = true;
                redeemMessage.textContent = "æ‚¨å·²ç»å…‘æ¢è¿‡ç§¯åˆ†";
                redeemMessage.style.color = "#888";
                redeemMessage.style.display = "block";
            }
        }

        // æ›´æ–°é—®å€™è¯­
        function updateGreeting() {
            const now = new Date();
            const hour = now.getHours();
            let greeting = '';
            
            if (hour < 6) {
                greeting = 'å‡Œæ™¨å¥½';
            } else if (hour < 9) {
                greeting = 'æ—©ä¸Šå¥½';
            } else if (hour < 12) {
                greeting = 'ä¸Šåˆå¥½';
            } else if (hour < 14) {
                greeting = 'ä¸­åˆå¥½';
            } else if (hour < 18) {
                greeting = 'ä¸‹åˆå¥½';
            } else {
                greeting = 'æ™šä¸Šå¥½';
            }
            
            const introTitle = document.querySelector('.chat-intro h1');
            if (introTitle) {
                introTitle.textContent = `${greeting}ï¼Œæˆ‘æ˜¯ Jork-v3`;
            }
        }

        modelSelect.value = 'Canto'; 

        // å¤„ç†ä¾§è¾¹æ è°ƒæ•´å¤§å°
        let isResizing = false;
        let initialX = 0;
        let initialWidth = 0;

        sidebarResizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            initialX = e.clientX;
            initialWidth = sidebar.offsetWidth;
            document.addEventListener('mousemove', handleMouseMove);
            document.addEventListener('mouseup', () => {
                isResizing = false;
                document.removeEventListener('mousemove', handleMouseMove);
            });
        });

        function handleMouseMove(e) {
            if (isResizing) {
                const newWidth = initialWidth + (e.clientX - initialX);
                if (newWidth >= 180 && newWidth <= 500) {
                    sidebar.style.width = newWidth + 'px';
                }
            }
        }

        // å¤„ç†èŠå¤©è¾“å…¥æ¡†è‡ªåŠ¨è°ƒæ•´é«˜åº¦
        function autoResizeTextarea() {
            chatInput.style.height = 'auto';
            chatInput.style.height = (chatInput.scrollHeight) + 'px';
        }

        // å‘é€æ¶ˆæ¯å¤„ç†
        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // ç»‘å®šè‡ªå®šä¹‰é€‰æ‹©æ¡†çš„ç‚¹å‡»äº‹ä»¶
document.querySelectorAll('.model-option').forEach(item => {
  item.addEventListener('click', () => {
    // ç§»é™¤æ‰€æœ‰é€‰é¡¹çš„æ¿€æ´»çŠ¶æ€
    document.querySelectorAll('.model-option').forEach(opt => opt.classList.remove('active'));
    // å°†å½“å‰ç‚¹å‡»é¡¹è®¾ä¸ºæ¿€æ´»çŠ¶æ€
    item.classList.add('active');
  });
});

// æ–°å¢DuckDuckGoæœç´¢å‡½æ•°
async function searchWeb(query) {
    try {
        const response = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(query)}&format=json&no_html=1&no_redirect=1`);
        const data = await response.json();
        return {
            abstract: data.AbstractText,
            results: data.RelatedTopics?.slice(0, 3).map(t => t.Text).filter(Boolean) || []
        };
    } catch (error) {
        console.error('æœç´¢å¤±è´¥:', error);
        return null;
    }
}

// ä¿®æ”¹æœç´¢æŒ‰é’®ç‚¹å‡»å¤„ç†
searchButton.addEventListener('click', () => {
    isSearching = !isSearching;
    document.querySelector('.search-status').classList.toggle('active', isSearching);
    searchButton.classList.toggle('active', isSearching);
});



    // ä¿®æ”¹å‘é€æ¶ˆæ¯æ—¶ç§¯åˆ†æ‰£é™¤é€»è¾‘ï¼ˆç¤ºä¾‹ä¸­çš„ sendMessage å‡½æ•°ä¸­ä½¿ç”¨ï¼‰
  async function sendMessage() {
    const message = chatInput.value.trim();
    if (!message) return;
    
    
    const cost = getSelectedModelCost();
    
    if (currentCredits < cost) {
      alert('ç§¯åˆ†ä¸è¶³ï¼Œè¯·å……å€¼åç»§ç»­ä½¿ç”¨ã€‚');
      return;
    }
    
    currentCredits -= cost;
    saveCreditsToStorage();
    updateCreditsDisplay();
    
    chatInput.value = '';
    chatInput.style.height = 'auto';
    
    const chatIntro = document.querySelector('.chat-intro');
    if (chatIntro) {
      chatIntro.style.display = 'none';
    }
    let searchContent = '';
    if (isSearching) {
        addMessage("ğŸ” æ­£åœ¨è”ç½‘æœç´¢æœ€æ–°ä¿¡æ¯...", 'system');
        const searchResult = await searchWeb(message);
        if (searchResult) {
            searchContent = `ç½‘ç»œæœç´¢ç»“æœï¼š
${searchResult.abstract ? `æ‘˜è¦ï¼š${searchResult.abstract}\n` : ''}
${searchResult.results.length > 0 ? `ç›¸å…³ç»“æœï¼š\n${searchResult.results.map((r,i) => `${i+1}. ${r}`).join('\n')}` : ''}`;
            
            // æ˜¾ç¤ºæœç´¢è¿‡ç¨‹
            addMessage(`ğŸŒ æœç´¢å®Œæˆï¼Œæ‰¾åˆ°${searchResult.results.length}æ¡ç›¸å…³ä¿¡æ¯`, 'system');
        }
    }

    // æ„å»ºAIæç¤ºè¯
    const aiPrompt = isSearching ? 
        `${searchContent}\n\nåŸºäºä»¥ä¸Šå®æ—¶ä¿¡æ¯å›ç­”ï¼š${message}` : 
        message;
    
    addMessage(message, 'user');
    
    const currentChat = chatHistory.find(chat => chat.id === currentChatId);
    if (currentChat) {
      currentChat.messages.push({
        role: 'user',
        content: message,
        timestamp: new Date().toISOString()
      });
      
      if (currentChat.messages.length === 1) {
        currentChat.title = message.length > 20 ? message.substring(0, 20) + '...' : message;
        updateChatHistoryUI();
      }
      
      saveChatHistory();
    }

            
            // åˆ›å»ºAIæ¶ˆæ¯æ¡†
            const aiMessageElement = document.createElement('div');
            aiMessageElement.className = 'message ai-message';
            
            const timeString = new Date().toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
            
            // ä¿®æ”¹ä¸º â†“â†“â†“
aiMessageElement.innerHTML = `
    <div class="message-content"></div>
    <div class="message-time">${timeString}</div>
    <div class="message-actions">
        <button class="action-btn like-btn" title="ç‚¹èµ"><i class="far fa-thumbs-up"></i></button>
        <button class="action-btn dislike-btn" title="ä¸å–œæ¬¢"><i class="far fa-thumbs-down"></i></button>
        <button class="action-btn copy-btn" title="å¤åˆ¶"><i class="far fa-copy"></i></button>
    </div>
`;
            chatArea.appendChild(aiMessageElement);

            // åœ¨ chatArea.appendChild(aiMessageElement); ä¹‹åæ·»åŠ  â†“â†“â†“
setTimeout(() => {
    const currentChat = chatHistory.find(chat => chat.id === currentChatId);
    const latestMessage = currentChat.messages[currentChat.messages.length - 1];
    bindMessageActions(aiMessageElement, latestMessage.id);
}, 100);
            
            const messageContentElement = aiMessageElement.querySelector('.message-content');
            let aiResponseText = '';
            
            try {
  // å¦‚æœå¼€å¯äº†æ€è€ƒæ¨¡å¼ï¼Œå…ˆæ˜¾ç¤ºæ€è€ƒè¿‡ç¨‹
  if (isThinking) {
    // ä»¥æ€è€ƒæ¨¡å¼è°ƒç”¨AI
    const thinkingPrompt = `
ç”¨æˆ·é—®ä½ ï¼ˆ${message}ï¼‰è¿™é‡Œæ˜¯ä½ çš„æ€è€ƒè¿‡ç¨‹ï¼š
1. é¦–å…ˆï¼Œä½ éœ€è¦è‚¯å®šç”¨æˆ·ä»¥è¡¨æ˜ä½ æ¥ä¸‹äº†è¿™ä¸ªä»»åŠ¡ï¼Œå¯ä»¥è¿ç”¨"å¥½çš„ğŸ‘Œ"ï¼Œ"å—¯ğŸ¤”"ç­‰ç½‘ç»œçƒ­æ¢—ï¼›
2. ç„¶ååˆ†æ®µå±•ç¤ºæ€è€ƒé¡ºåºï¼š
   - é¦–å…ˆåˆ†æç”¨æˆ·çš„é—®é¢˜ï¼š"${message}"ï¼Œå‘ç°éœ€è¦...
   - ç„¶åï¼Œ
3. æœ€åæ€»ç»“ç­”æ¡ˆã€‚
`;
            
                    
                    // æ˜¾ç¤ºæ€è€ƒåŒºåŸŸ
                    const thinkingElement = document.createElement('div');
                    thinkingElement.className = 'message ai-message';
                    thinkingElement.innerHTML = `
                        <div class="message-content">
                            <div class="thinking-process">
                                <strong>æ€è€ƒè¿‡ç¨‹ï¼š</strong><br>
                                <span id="thinking-text"></span>
                            </div>
                        </div>
                        <div class="message-time">${timeString}</div>
                    `;
                    chatArea.appendChild(thinkingElement);
                    const thinkingTextElement = thinkingElement.querySelector('#thinking-text');
                    
                    // è°ƒç”¨APIè·å–æ€è€ƒè¿‡ç¨‹ï¼Œåˆ†æ®µæ˜¾ç¤º
                    let thinkingText = '';
                    await callAI(thinkingPrompt, (chunk, isDone) => {
                        thinkingText += chunk;
                        thinkingTextElement.textContent = thinkingText;
                        chatArea.scrollTop = chatArea.scrollHeight;
                    });
                    
                    // æ€è€ƒå®Œæˆåï¼Œç­‰å¾…ä¸€å°æ®µæ—¶é—´å†æ˜¾ç¤ºç­”æ¡ˆ
                    setTimeout(() => {
                        // è°ƒç”¨APIè·å–æœ€ç»ˆå›ç­”ï¼Œæµå¼æ˜¾ç¤º
                        callAI(message, (chunk, isDone) => {
                            // ç´¯ç§¯å“åº”æ–‡æœ¬
                            aiResponseText += chunk;
                            
                            // å®æ—¶æ›´æ–°UI
                            const currentHTML = messageContentElement.innerHTML;
                            messageContentElement.innerHTML = formatPartialMessageContent(aiResponseText);
                            chatArea.scrollTop = chatArea.scrollHeight;
                            
                            // å¦‚æœæ˜¯å®Œæ•´å“åº”ï¼Œä¿å­˜åˆ°èŠå¤©å†å²
                            if (isDone && currentChat) {
                                currentChat.messages.push({
                                    id: `msg_${Date.now()}`, // æ·»åŠ å”¯ä¸€ID
                                    role: 'assistant',
                                    content: aiResponseText,
                                    timestamp: new Date().toISOString(),
                                    feedback: null,// æ–°å¢åé¦ˆå­—æ®µ
                                    thinking: thinkingText
                                });
                                saveChatHistory();
                                // å®Œæˆåè¿›è¡Œå®Œæ•´æ ¼å¼åŒ–
                                finalizeMessageContent(messageContentElement, aiResponseText);
                            }
                        });
                    }, 1000);
                    
                } else {
                    // ç›´æ¥è°ƒç”¨AIè·å–å›å¤ï¼Œæµå¼æ˜¾ç¤º
                    callAI(message, (chunk, isDone) => {
                        // ç´¯ç§¯å“åº”æ–‡æœ¬
                        aiResponseText += chunk;
                        
                        // å®æ—¶æ›´æ–°UI
                        messageContentElement.innerHTML = formatPartialMessageContent(aiResponseText);
                        chatArea.scrollTop = chatArea.scrollHeight;
                        
                        // å¦‚æœæ˜¯å®Œæ•´å“åº”ï¼Œä¿å­˜åˆ°èŠå¤©å†å²
                        if (isDone && currentChat) {
                            currentChat.messages.push({
                                role: 'assistant',
                                content: aiResponseText,
                                timestamp: new Date().toISOString()
                            });
                            saveChatHistory();
                            // å®Œæˆåè¿›è¡Œå®Œæ•´æ ¼å¼åŒ–
                            finalizeMessageContent(messageContentElement, aiResponseText);
                        }
                    });
                }
            } catch (error) {
                console.error('AI APIè°ƒç”¨å¤±è´¥:', error);
                messageContentElement.innerHTML = 'æŠ±æ­‰ï¼Œæˆ‘é‡åˆ°äº†é—®é¢˜ï¼Œæ— æ³•å›åº”ä½ çš„è¯·æ±‚ã€‚è¯·ç¨åå†è¯•ã€‚';
            }
        }

        // è°ƒç”¨AI APIï¼Œæ”¯æŒæµå¼è¾“å‡º
        async function callAI(message, onChunk) {
            try {
                // å®é™…è°ƒç”¨DeepSeek API
                const apiUrl = "https://api.deepseek.com/v1/chat/completions";
                const apiKey = "sk-e1ed90c2effc4415beeee85845f66d05"; // ä½¿ç”¨æä¾›çš„APIå¯†é’¥
                
                // æ„å»ºè¯·æ±‚å‚æ•°ï¼Œæ·»åŠ  stream: true
                const requestOptions = {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            {
                                role: "user",
                                content: message
                            }
                        ],
                        temperature: 0.7,
                        max_tokens: 800,
                        stream: true // å¯ç”¨æµå¼è¾“å‡º
                    })
                };
                
                try {
                    const response = await fetch(apiUrl, requestOptions);
                    
                    if (!response.ok) {
                        console.error('APIè¯·æ±‚å¤±è´¥:', response.status, response.statusText);
                        const errorData = await response.json().catch(() => ({}));
                        console.error('é”™è¯¯è¯¦æƒ…:', errorData);
                        
                        // å¦‚æœAPIè¯·æ±‚å¤±è´¥ï¼Œä½¿ç”¨åå¤‡å“åº”
                        const fallback = generateFallbackResponse(message, isThinking);
                        onChunk(fallback.response, true); // ä¸€æ¬¡æ€§å‘é€å…¨éƒ¨åå¤‡å“åº”
                        return;
                    }
                    
                    const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        
        while (true) {
            const { done, value } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            
            // å¤„ç†å¯èƒ½å­˜åœ¨çš„å¤šè¡Œæ•°æ®
            const parts = buffer.split('\n');
            buffer = parts.pop() || ''; // ä¿ç•™æœªå¤„ç†å®Œçš„éƒ¨åˆ†
            
            for (const line of parts) {
                if (line.startsWith('data: ')) {
                    try {
                        const data = JSON.parse(line.substring(6));
                        if (data.choices?.[0]?.delta?.content) {
                            onChunk(data.choices[0].delta.content, false);
                        }
                    } catch (e) {
                        console.error('è§£æSSEæ•°æ®å‡ºé”™:', e);
                    }
                }
            }
        }
        onChunk('', true);
                } catch (apiError) {
                    console.error('APIè°ƒç”¨å¼‚å¸¸:', apiError);
                    // å¦‚æœAPIè¯·æ±‚å‡ºé”™ï¼Œä½¿ç”¨åå¤‡å“åº”
                    const fallback = generateFallbackResponse(message, isThinking);
                    onChunk(fallback.response, true); // ä¸€æ¬¡æ€§å‘é€å…¨éƒ¨åå¤‡å“åº”
                    return fallback.response;
                }
            } catch (error) {
                console.error('è°ƒç”¨å¤±è´¥:', error);
                throw error;
            }
        }
        
        // ç”Ÿæˆåå¤‡å“åº”ï¼ˆå½“APIè°ƒç”¨å¤±è´¥æ—¶ä½¿ç”¨ï¼‰
        function generateFallbackResponse(message, showThinking) {
            // æ ¹æ®ä¸åŒçš„æ¶ˆæ¯ç±»å‹è¿”å›ä¸åŒçš„æ ·å¼ç¤ºä¾‹
            let response = '';
            let thinking = '';
            
            if (showThinking) {
                thinking = `æˆ‘éœ€è¦åˆ†æè¿™ä¸ªé—®é¢˜çš„å‡ ä¸ªæ–¹é¢ï¼š
1. é¦–å…ˆç†è§£é—®é¢˜çš„æ ¸å¿ƒæ˜¯ä»€ä¹ˆ
2. æŸ¥æ‰¾æˆ‘çŸ¥è¯†åº“ä¸­çš„ç›¸å…³ä¿¡æ¯
3. ç»„ç»‡ä¿¡æ¯å½¢æˆè¿è´¯çš„å›ç­”
4. ç¡®ä¿å›ç­”å…¨é¢è€Œå‡†ç¡®`;
            }
            
            if (message.includes('ä»£ç ') || message.includes('ç¼–ç¨‹') || message.includes('Python')) {
                response = `
                æˆ‘å¾ˆä¹æ„å¸®ä½ ç¼–å†™ä¸€æ®µPythonä»£ç ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„æ•°æ®åˆ†æç¤ºä¾‹ï¼š

                \`\`\`python
                import pandas as pd
                import matplotlib.pyplot as plt
                import seaborn as sns

                # è¯»å–æ•°æ®
                def analyze_data(file_path):
                    # è¯»å–CSVæ–‡ä»¶
                    df = pd.read_csv(file_path)
                    
                    # æ˜¾ç¤ºåŸºæœ¬ä¿¡æ¯
                    print("æ•°æ®æ¦‚è§ˆ:")
                    print(df.head())
                    print("\\nåŸºæœ¬ç»Ÿè®¡:")
                    print(df.describe())
                    
                    # æ£€æŸ¥ç¼ºå¤±å€¼
                    missing = df.isnull().sum()
                    if missing.sum() > 0:
                        print("\\nç¼ºå¤±å€¼:")
                        print(missing[missing > 0])
                    
                    # åˆ›å»ºä¸€äº›å¯è§†åŒ–
                    plt.figure(figsize=(12, 6))
                    
                    # æ•°å€¼åˆ—çš„ç›´æ–¹å›¾
                    numeric_cols = df.select_dtypes(include=['number']).columns
                    if len(numeric_cols) > 0:
                        df[numeric_cols[:5]].hist(figsize=(12, 8))
                        plt.tight_layout()
                        plt.savefig('histograms.png')
                        
                    return df

                # ä½¿ç”¨æ–¹æ³•
                if __name__ == "__main__":
                    data = analyze_data("your_data.csv")
                    
                    # ç›¸å…³æ€§åˆ†æ
                    corr = data.corr()
                    plt.figure(figsize=(10, 8))
                    sns.heatmap(corr, annot=True, cmap='coolwarm', linewidths=0.5)
                    plt.savefig('correlation.png')
                    plt.show()
                \`\`\`

                è¿™æ®µä»£ç å¯ä»¥å¸®ä½ å¿«é€Ÿåˆ†æCSVæ–‡ä»¶ï¼Œå®ƒä¼š:
                1. æ˜¾ç¤ºæ•°æ®çš„å‰å‡ è¡Œ
                2. æä¾›åŸºæœ¬ç»Ÿè®¡ä¿¡æ¯
                3. æ£€æŸ¥å’ŒæŠ¥å‘Šç¼ºå¤±å€¼
                4. ä¸ºæ•°å€¼åˆ—åˆ›å»ºç›´æ–¹å›¾
                5. è®¡ç®—å¹¶å¯è§†åŒ–ç›¸å…³æ€§çŸ©é˜µ

                ä½ å¯ä»¥é€šè¿‡ä¿®æ”¹æ–‡ä»¶è·¯å¾„æ¥åˆ†æä½ è‡ªå·±çš„æ•°æ®ã€‚å¦‚æœéœ€è¦æ·»åŠ å…¶ä»–åˆ†æåŠŸèƒ½ï¼Œè¯·å‘Šè¯‰æˆ‘ã€‚
                `;
            } else if (message.includes('è¡¨æ ¼') || message.includes('æ•°æ®') || message.includes('ç»Ÿè®¡')) {
                response = `
                æ ¹æ®ä½ çš„è¯·æ±‚ï¼Œè¿™é‡Œæ˜¯2023å¹´å…¨çƒå‰10å¤§ç§‘æŠ€å…¬å¸çš„å¸‚å€¼ç»Ÿè®¡è¡¨æ ¼ï¼š

                | æ’å | å…¬å¸åç§° | å¸‚å€¼ (åäº¿ç¾å…ƒ) | æ€»éƒ¨æ‰€åœ¨åœ° | ä¸»è¦ä¸šåŠ¡é¢†åŸŸ |
                |------|---------|---------------|------------|------------|
                | 1    | Apple   | 2,940         | ç¾å›½       | æ¶ˆè´¹ç”µå­äº§å“ã€è½¯ä»¶æœåŠ¡ |
                | 2    | Microsoft | 2,830       | ç¾å›½       | è½¯ä»¶ã€äº‘æœåŠ¡ã€ç¡¬ä»¶ |
                | 3    | Saudi Aramco | 2,100    | æ²™ç‰¹é˜¿æ‹‰ä¼¯ | çŸ³æ²¹ã€å¤©ç„¶æ°” |
                | 4    | Alphabet (Google) | 1,840 | ç¾å›½    | æœç´¢å¼•æ“ã€å¹¿å‘Šã€äº‘æœåŠ¡ |
                | 5    | Amazon  | 1,650         | ç¾å›½       | ç”µå­å•†åŠ¡ã€äº‘æœåŠ¡ |
                | 6    | NVIDIA  | 1,230         | ç¾å›½       | åŠå¯¼ä½“ã€AIèŠ¯ç‰‡ |
                | 7    | Meta Platforms | 980    | ç¾å›½       | ç¤¾äº¤åª’ä½“ã€å…ƒå®‡å®™ |
                | 8    | Tesla   | 865           | ç¾å›½       | ç”µåŠ¨æ±½è½¦ã€èƒ½æºäº§å“ |
                | 9    | Berkshire Hathaway | 780 | ç¾å›½    | å¤šå…ƒåŒ–æ§è‚¡å…¬å¸ |
                | 10   | TSMC    | 550           | å°æ¹¾       | åŠå¯¼ä½“åˆ¶é€  |

                è¿™äº›å…¬å¸åœ¨ç§‘æŠ€åˆ›æ–°å’Œå…¨çƒç»æµä¸­æ‰®æ¼”ç€é‡è¦è§’è‰²ã€‚å¸‚å€¼æ•°æ®æˆªè‡³2023å¹´12æœˆï¼Œå¯èƒ½ä¼šéšå¸‚åœºæ³¢åŠ¨è€Œå˜åŒ–ã€‚ä½ å¯¹å…¶ä¸­æŸå®¶å…¬å¸ç‰¹åˆ«æ„Ÿå…´è¶£å—ï¼Ÿæˆ‘å¯ä»¥æä¾›æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚
                `;
            } else {
                response = `æ„Ÿè°¢ä½ çš„æé—®ï¼ä½œä¸ºJork-v3äººå·¥æ™ºèƒ½åŠ©æ‰‹ï¼Œæˆ‘å¾ˆé«˜å…´èƒ½å¸®åŠ©ä½ ã€‚

ä½ çš„é—®é¢˜æ¶‰åŠåˆ°äº†${message.slice(0, 30)}...è¿™ä¸ªé¢†åŸŸã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸æœ‰è¶£çš„è¯é¢˜ï¼Œè®©æˆ‘æ¥è¯¦ç»†è§£ç­”ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç†è§£çš„æ˜¯ï¼Œè¿™ä¸ªé¢†åŸŸè¿‘å¹´æ¥å‘å±•è¿…é€Ÿï¼Œä¸»è¦æ˜¯å› ä¸ºæŠ€æœ¯åˆ›æ–°å’Œå¸‚åœºéœ€æ±‚çš„å…±åŒæ¨åŠ¨ã€‚æ ¹æ®æœ€æ–°ç ”ç©¶ï¼Œè¿™ä¸€é¢†åŸŸåœ¨è¿‡å»äº”å¹´å†…å¢é•¿äº†çº¦35%ï¼Œé¢„è®¡æœªæ¥è¿˜å°†ç»§ç»­ä¿æŒå¼ºåŠ²åŠ¿å¤´ã€‚

åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡ ä¸ªä¸»è¦è¶‹åŠ¿ï¼š

1. æ•°æ®é©±åŠ¨å†³ç­–å˜å¾—è¶Šæ¥è¶Šæ™®é
2. è‡ªåŠ¨åŒ–æŠ€æœ¯å¤§å¹…æé«˜äº†æ•ˆç‡
3. äººæœºåä½œæ¨¡å¼æ­£åœ¨é‡å¡‘å·¥ä½œæ–¹å¼
4. å¯æŒç»­å‘å±•æˆä¸ºæ ¸å¿ƒè€ƒé‡å› ç´ 

å¦‚æœä½ æƒ³æ·±å…¥äº†è§£è¿™ä¸ªè¯é¢˜ï¼Œæˆ‘å»ºè®®ä»å‡ ä¸ªæƒå¨æ¥æºå¼€å§‹ç ”ç©¶ã€‚åŒæ—¶ï¼Œå¦‚æœä½ æœ‰æ›´å…·ä½“çš„é—®é¢˜æˆ–éœ€æ±‚ï¼Œæˆ‘å¾ˆä¹æ„æä¾›æ›´æœ‰é’ˆå¯¹æ€§çš„å¸®åŠ©ã€‚

å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼å¦‚æœä½ æœ‰ä»»ä½•åç»­é—®é¢˜ï¼Œéšæ—¶å¯ä»¥å‘æˆ‘æé—®ã€‚`;
            }
            
            return { response, thinking };
        }
        // åœ¨ generateFallbackResponse å‡½æ•°ä¹‹åæ·»åŠ  â†“â†“â†“
function bindMessageActions(messageElement, messageId) {
    const likeBtn = messageElement.querySelector('.like-btn');
    const dislikeBtn = messageElement.querySelector('.dislike-btn');
    const copyBtn = messageElement.querySelector('.copy-btn');
    const messageContent = messageElement.querySelector('.message-content');

    // ç‚¹èµåŠŸèƒ½
    likeBtn.addEventListener('click', () => {
        const currentChat = chatHistory.find(chat => chat.id === currentChatId);
        const message = currentChat.messages.find(m => m.id === messageId);
        message.feedback = message.feedback === 'like' ? null : 'like';
        
        likeBtn.innerHTML = message.feedback === 'like' 
            ? '<i class="fas fa-thumbs-up"></i>' 
            : '<i class="far fa-thumbs-up"></i>';
        dislikeBtn.innerHTML = '<i class="far fa-thumbs-down"></i>';
        
        saveChatHistory();
    });

    // ä¸å–œæ¬¢åŠŸèƒ½
    dislikeBtn.addEventListener('click', () => {
        const currentChat = chatHistory.find(chat => chat.id === currentChatId);
        const message = currentChat.messages.find(m => m.id === messageId);
        message.feedback = message.feedback === 'dislike' ? null : 'dislike';
        
        dislikeBtn.innerHTML = message.feedback === 'dislike' 
            ? '<i class="fas fa-thumbs-down"></i>' 
            : '<i class="far fa-thumbs-down"></i>';
        likeBtn.innerHTML = '<i class="far fa-thumbs-up"></i>';
        
        saveChatHistory();
    });

    // å¤åˆ¶åŠŸèƒ½
    copyBtn.addEventListener('click', () => {
        navigator.clipboard.writeText(messageContent.textContent).then(() => {
            copyBtn.innerHTML = '<i class="fas fa-check"></i>';
            setTimeout(() => {
                copyBtn.innerHTML = '<i class="far fa-copy"></i>';
            }, 2000);
        });
    });
}
// â†‘â†‘â†‘ æ·»åŠ åˆ°æ­¤ç»“æŸ

        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©åŒºåŸŸ
        function addMessage(content, role) {
            const messageElement = document.createElement('div');
            messageElement.className = `message ${role}-message`;
            
            // æ ¼å¼åŒ–å†…å®¹ï¼ˆå¤„ç†ä»£ç å—å’Œè¡¨æ ¼ï¼‰
            let formattedContent = formatMessageContent(content);
            
            // æ·»åŠ æ—¶é—´æˆ³
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            messageElement.innerHTML = `
                <div class="message-content">${formattedContent}</div>
                <div class="message-time">${timeString}</div>
            `;
            
            chatArea.appendChild(messageElement);
            chatArea.scrollTop = chatArea.scrollHeight;
            
            // æ·»åŠ ä»£ç å¤åˆ¶åŠŸèƒ½
            const copyButtons = messageElement.querySelectorAll('.copy-code-btn');
            copyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const codeBlock = button.closest('.code-block').querySelector('.code-content');
                    navigator.clipboard.writeText(codeBlock.textContent)
                        .then(() => {
                            button.innerHTML = '<i class="fas fa-check"></i>';
                            setTimeout(() => {
                                button.innerHTML = '<i class="far fa-copy"></i>';
                            }, 2000);
                        });
                });
            });
        }

        // æ ¼å¼åŒ–éƒ¨åˆ†æ¶ˆæ¯å†…å®¹ï¼ˆç”¨äºæµå¼è¾“å‡ºï¼‰
        function formatPartialMessageContent(text) {
            // ç®€å•æ ¼å¼åŒ–ï¼Œå¯¹æµå¼è¾“å‡ºçš„éƒ¨åˆ†æ–‡æœ¬è¿›è¡ŒåŸºæœ¬å¤„ç†
            let formatted = text;
            
            // å¤„ç†æ¢è¡Œ
            formatted = formatted.replace(/\n/g, '<br>');
            
            // ç®€å•å¤„ç†ç²—ä½“
            formatted = formatted.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            
            return formatted;
        }

        // å®Œæˆæ¶ˆæ¯å†…å®¹çš„æœ€ç»ˆæ ¼å¼åŒ–ï¼ˆç”¨äºæµå¼è¾“å‡ºå®Œæˆåï¼‰
        function finalizeMessageContent(element, text) {
            element.innerHTML = formatMessageContent(text);
            
            // æ·»åŠ ä»£ç å¤åˆ¶åŠŸèƒ½
            const copyButtons = element.querySelectorAll('.copy-code-btn');
            copyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const codeBlock = button.closest('.code-block').querySelector('.code-content');
                    navigator.clipboard.writeText(codeBlock.textContent)
                        .then(() => {
                            button.innerHTML = '<i class="fas fa-check"></i>';
                            setTimeout(() => {
                                button.innerHTML = '<i class="far fa-copy"></i>';
                            }, 2000);
                        });
                });
            });
        }

        // æ ¼å¼åŒ–æ¶ˆæ¯å†…å®¹ï¼ˆè¯†åˆ«ä»£ç å—å’Œè¡¨æ ¼ï¼‰
        function formatMessageContent(content) {
            // å¤„ç†æ ‡é¢˜
    content = content.replace(/^##\s+(.+)$/gm, '<h2 class="message-heading">$1</h2>');
    content = content.replace(/^###\s+(.+)$/gm, '<h3 class="message-subheading">$1</h3>');
    content = content.replace(/ç½‘ç»œæœç´¢ç»“æœï¼š/g, '<div class="search-results"><h4>ç½‘ç»œæœç´¢ç»“æœ</h4>');
    content = content.replace(/æ‘˜è¦ï¼š/g, '<div class="search-abstract"><strong>æ‘˜è¦ï¼š</strong>');
    content = content.replace(/ç›¸å…³ç»“æœï¼š/g, '</div><div class="related-results"><strong>ç›¸å…³ç»“æœï¼š</strong><ul>');
    content = content.replace(/\d+\. /g, '<li>');
    content = content.replace(/(\n|$)/g, '</li>$1');
    content = content.replace(/(<\/ul>)?<\/div>/g, '</ul></div></div>');
            // å¤„ç†ä»£ç å—
            content = content.replace(/```([a-z]*)\n([\s\S]*?)```/g, (match, language, code) => {
                return `
                <div class="code-block">
                    <div class="code-header">
                        <span>${language || 'Code'}</span>
                        <button class="copy-code-btn"><i class="far fa-copy"></i></button>
                    </div>
                    <div class="code-content">${code.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</div>
                </div>
                `;
            });
            
            // å¤„ç†è¡¨æ ¼
            content = content.replace(/\|(.+)\|[\r\n]/gm, (match, content) => {
                // æ£€æµ‹æ˜¯å¦æ˜¯è¡¨å¤´åˆ†éš”è¡Œ
                if (/^\s*[-:]+\s*$/.test(content.replace(/\|/g, ''))) {
                    return ''; // åˆ é™¤åˆ†éš”è¡Œ
                }
                
                // å°†è¡¨æ ¼è¡Œå†…å®¹æ‹†åˆ†ä¸ºå•å…ƒæ ¼
                const cells = content.split('|').map(cell => cell.trim()).filter(cell => cell);
                
                // åˆ›å»ºè¡¨æ ¼è¡Œ
                const isHeader = /^\s*---/.test(match);
                const cellTag = isHeader ? 'th' : 'td';
                
                return `<tr>${cells.map(cell => `<${cellTag}>${cell}</${cellTag}>`).join('')}</tr>`;
            });
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«è¡¨æ ¼å¹¶æ·»åŠ è¡¨æ ¼å®¹å™¨
            if (content.includes('<tr>')) {
                content = content.replace(/<tr>([\s\S]*?)<\/tr>/g, (match, rowContent, index, fullString) => {
                    // å¦‚æœè¿™æ˜¯ç¬¬ä¸€è¡Œï¼Œæ·»åŠ è¡¨æ ¼å¼€å§‹æ ‡ç­¾
                    if (!fullString.substring(0, index).includes('<tr>')) {
                        return `<div class="table-container"><table><thead>${match}</thead><tbody>`;
                    }
                    // å¦‚æœè¿™æ˜¯æœ€åä¸€è¡Œï¼Œæ·»åŠ è¡¨æ ¼ç»“æŸæ ‡ç­¾
                    else if (!fullString.substring(index + match.length).includes('<tr>')) {
                        return `${match}</tbody></table></div>`;
                    }
                    // ä¸­é—´è¡Œä¿æŒä¸å˜
                    return match;
                });
            }
            
            // å¤„ç†æ¢è¡Œä¸ºæ®µè½
            const paragraphs = content.split('\n\n');
            if (paragraphs.length > 1) {
                content = paragraphs.map(p => p.trim()).filter(p => p && !p.includes('<div class="code-block">') && !p.includes('<div class="table-container">'))
                    .map(p => `<p>${p}</p>`).join('') + content.match(/<div class="(code-block|table-container)">/g)?.map(match => {
                        const startIndex = content.indexOf(match);
                        const endIndex = content.indexOf('</div>', startIndex + match.length) + 6;
                        return content.substring(startIndex, endIndex);
                    }).join('') || '';
            }
            
            return content;
        }

        // å¤„ç†æ€è€ƒæ¨¡å¼
        thinkingButton.addEventListener('click', () => {
            isThinking = !isThinking;
            thinkingButton.classList.toggle('active', isThinking);
            if (isThinking) {
                thinkingButton.style.color = 'var(--primary-color)';
            } else {
                thinkingButton.style.color = '';
            }
        });

        // å¤„ç†æœç´¢æ¨¡å¼
        searchButton.addEventListener('click', () => {
            isSearching = !isSearching;
            searchButton.classList.toggle('active', isSearching);
            if (isSearching) {
                searchButton.style.color = 'var(--primary-color)';
            } else {
                searchButton.style.color = '';
            }
        });

        // å¤„ç†æ–‡ä»¶ä¸Šä¼ 
        uploadButton.addEventListener('click', () => {
            fileUpload.click();
        });

        fileUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const fileName = file.name;
                chatInput.value += `[æ–‡ä»¶: ${fileName}] `;
                chatInput.focus();
            }
        });

        // æ›´æ–°ç§¯åˆ†æ˜¾ç¤º
        function updateCreditsDisplay() {
    creditDisplay.textContent = `ç§¯åˆ†ï¼š${currentCredits}`;
    // æ·»åŠ ç§¯åˆ†é¢œè‰²å˜åŒ–æç¤º
    const diff = currentCredits - localStorage.getItem('jorkCredits');
    if (diff !== 0) {
        creditDisplay.style.color = diff > 0 ? '#4CAF50' : '#FF5722';
        setTimeout(() => {
            creditDisplay.style.color = '';
        }, 1000);
    }
}

        // æ–°å»ºèŠå¤©
        newChatBtn.addEventListener('click', () => {
            currentChatId = 'chat_' + Date.now();
            chatHistory.push({
                id: currentChatId,
                title: 'æ–°çš„èŠå¤©',
                messages: []
            });
            saveChatHistory();
            updateChatHistoryUI();
            
            // æ¸…ç©ºèŠå¤©åŒºåŸŸ
            chatArea.innerHTML = '';
            
            // é‡æ–°æ˜¾ç¤ºä»‹ç»åŒºåŸŸ
            const chatIntroHTML = `
                <div class="chat-intro">
                    <h1>${getGreeting()}ï¼Œæˆ‘æ˜¯ JorkAI</h1>
                    <p>æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</p>
                    <div class="featured-sections">
        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-fire"></i>
                <h2>çƒ­é—¨æœç´¢</h2>
            </div>
            <div class="search-grid">
                <div class="search-item" data-query="ChatGPTå’ŒClaudeæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">
                    <span>ChatGPTå’ŒClaudeæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="å¦‚ä½•æé«˜è‹±è¯­å£è¯­æ°´å¹³ï¼Ÿ">
                    <span>å¦‚ä½•æé«˜è‹±è¯­å£è¯­æ°´å¹³ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="Pythonå’ŒJavaScriptå“ªä¸ªæ›´é€‚åˆåˆå­¦è€…ï¼Ÿ">
                    <span>Pythonå’ŒJavaScriptå“ªä¸ªæ›´é€‚åˆåˆå­¦è€…ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="äººå·¥æ™ºèƒ½ä¼šå–ä»£å“ªäº›å·¥ä½œï¼Ÿ">
                    <span>äººå·¥æ™ºèƒ½ä¼šå–ä»£å“ªäº›å·¥ä½œï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="å¦‚ä½•æœ‰æ•ˆç®¡ç†æ—¶é—´ï¼Ÿ">
                    <span>å¦‚ä½•æœ‰æ•ˆç®¡ç†æ—¶é—´ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="2025å¹´å€¼å¾—å…³æ³¨çš„ç§‘æŠ€è¶‹åŠ¿">
                    <span>2025å¹´å€¼å¾—å…³æ³¨çš„ç§‘æŠ€è¶‹åŠ¿</span>
                </div>
            </div>
        </div>
        
        <!-- Try asking me section -->
        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-question-circle"></i>
                <h2>è¯•ç€é—®æˆ‘</h2>
            </div>
            <div class="ask-grid">
                <div class="ask-item" data-query="å¸®æˆ‘å†™ä¸€ç¯‡å…³äºç¯ä¿çš„æ¼”è®²ç¨¿">
                    <div class="ask-icon"><i class="fas fa-pencil-alt"></i></div>
                    <div class="ask-content">
                        <h3>å†™ä½œåŠ©æ‰‹</h3>
                        <p>å¸®æˆ‘å†™ä¸€ç¯‡å…³äºç¯ä¿çš„æ¼”è®²ç¨¿</p>
                    </div>
                </div>
                <div class="ask-item" data-query="è§£é‡Šä¸€ä¸‹åŒºå—é“¾æŠ€æœ¯çš„å·¥ä½œåŸç†">
                    <div class="ask-icon"><i class="fas fa-lightbulb"></i></div>
                    <div class="ask-content">
                        <h3>çŸ¥è¯†è§£ç­”</h3>
                        <p>è§£é‡Šä¸€ä¸‹åŒºå—é“¾æŠ€æœ¯çš„å·¥ä½œåŸç†</p>
                    </div>
                </div>
                <div class="ask-item" data-query="è®¾è®¡ä¸€ä¸ªPythonçˆ¬è™«è·å–æ–°é—»æ ‡é¢˜">
                    <div class="ask-icon"><i class="fas fa-code"></i></div>
                    <div class="ask-content">
                        <h3>ç¼–ç¨‹å¸®åŠ©</h3>
                        <p>è®¾è®¡ä¸€ä¸ªPythonçˆ¬è™«è·å–æ–°é—»æ ‡é¢˜</p>
                    </div>
                </div>
                <div class="ask-item" data-query="å¦‚ä½•åœ¨ä¸€å‘¨å†…å­¦ä¼šåŸºç¡€ç‘œä¼½åŠ¨ä½œï¼Ÿ">
                    <div class="ask-icon"><i class="fas fa-dumbbell"></i></div>
                    <div class="ask-content">
                        <h3>å¥åº·ç”Ÿæ´»</h3>
                        <p>å¦‚ä½•åœ¨ä¸€å‘¨å†…å­¦ä¼šåŸºç¡€ç‘œä¼½åŠ¨ä½œï¼Ÿ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
                </div>
            `;
            chatArea.innerHTML = chatIntroHTML;
            
            // é‡æ–°ç»‘å®šç¤ºä¾‹é—®é¢˜äº‹ä»¶
            document.querySelectorAll('.example-item').forEach(item => {
                item.addEventListener('click', () => {
                    const question = item.querySelector('strong').textContent;
                    chatInput.value = question;
                    sendMessage();
                });
            });
        });

        // è·å–å½“å‰æ—¶é—´é—®å€™è¯­
        function getGreeting() {
            const now = new Date();
            const hour = now.getHours();
            
            if (hour < 6) return 'å‡Œæ™¨å¥½';
            if (hour < 9) return 'æ—©ä¸Šå¥½';
            if (hour < 12) return 'ä¸Šåˆå¥½';
            if (hour < 14) return 'ä¸­åˆå¥½';
            if (hour < 18) return 'ä¸‹åˆå¥½';
            return 'æ™šä¸Šå¥½';
        }

        // åŠ è½½èŠå¤©å†å²
        function loadChatHistory() {
            const savedHistory = localStorage.getItem('jorkChatHistory');
            if (savedHistory) {
                chatHistory = JSON.parse(savedHistory);
            }
        }

        // ä¿å­˜èŠå¤©å†å²
        function saveChatHistory() {
            localStorage.setItem('jorkChatHistory', JSON.stringify(chatHistory));
        }

        // æ›´æ–°èŠå¤©å†å²UI
        function updateChatHistoryUI() {
            const historyContainer = document.querySelector('.chat-history');
            historyContainer.innerHTML = '';
            
            chatHistory.forEach(chat => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                if (chat.id === currentChatId) {
                    historyItem.classList.add('active');
                }
                historyItem.textContent = chat.title;
                historyItem.dataset.chatId = chat.id;
                
                historyItem.addEventListener('click', () => {
                    loadChat(chat.id);
                });
                
                historyContainer.appendChild(historyItem);
            });
        }

        // åŠ è½½ç‰¹å®šèŠå¤©
        function loadChat(chatId) {
            const chat = chatHistory.find(c => c.id === chatId);
            if (!chat) return;
            
            currentChatId = chatId;
            updateChatHistoryUI();
            
            // æ¸…ç©ºèŠå¤©åŒºåŸŸ
            chatArea.innerHTML = '';
            
            // å¦‚æœæ²¡æœ‰æ¶ˆæ¯ï¼Œæ˜¾ç¤ºä»‹ç»é¡µé¢
            if (chat.messages.length === 0) {
                const chatIntroHTML = `
                    <div class="chat-intro">
                        <h1>${getGreeting()}ï¼Œæˆ‘æ˜¯ Jork-v3</h1>
                        <p>æœ‰ä»€ä¹ˆå¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ</p>
                        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-fire"></i>
                <h2>çƒ­é—¨æœç´¢</h2>
            </div>
            <div class="search-grid">
                <div class="search-item" data-query="ChatGPTå’ŒClaudeæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ">
                    <span>ChatGPTå’ŒClaudeæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="å¦‚ä½•æé«˜è‹±è¯­å£è¯­æ°´å¹³ï¼Ÿ">
                    <span>å¦‚ä½•æé«˜è‹±è¯­å£è¯­æ°´å¹³ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="Pythonå’ŒJavaScriptå“ªä¸ªæ›´é€‚åˆåˆå­¦è€…ï¼Ÿ">
                    <span>Pythonå’ŒJavaScriptå“ªä¸ªæ›´é€‚åˆåˆå­¦è€…ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="äººå·¥æ™ºèƒ½ä¼šå–ä»£å“ªäº›å·¥ä½œï¼Ÿ">
                    <span>äººå·¥æ™ºèƒ½ä¼šå–ä»£å“ªäº›å·¥ä½œï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="å¦‚ä½•æœ‰æ•ˆç®¡ç†æ—¶é—´ï¼Ÿ">
                    <span>å¦‚ä½•æœ‰æ•ˆç®¡ç†æ—¶é—´ï¼Ÿ</span>
                </div>
                <div class="search-item" data-query="2025å¹´å€¼å¾—å…³æ³¨çš„ç§‘æŠ€è¶‹åŠ¿">
                    <span>2025å¹´å€¼å¾—å…³æ³¨çš„ç§‘æŠ€è¶‹åŠ¿</span>
                </div>
            </div>
        </div>
        
        <!-- Try asking me section -->
        <div class="section-container">
            <div class="section-header">
                <i class="fas fa-question-circle"></i>
                <h2>è¯•ç€é—®æˆ‘</h2>
            </div>
            <div class="ask-grid">
                <div class="ask-item" data-query="å¸®æˆ‘å†™ä¸€ç¯‡å…³äºç¯ä¿çš„æ¼”è®²ç¨¿">
                    <div class="ask-icon"><i class="fas fa-pencil-alt"></i></div>
                    <div class="ask-content">
                        <h3>å†™ä½œåŠ©æ‰‹</h3>
                        <p>å¸®æˆ‘å†™ä¸€ç¯‡å…³äºç¯ä¿çš„æ¼”è®²ç¨¿</p>
                    </div>
                </div>
                <div class="ask-item" data-query="è§£é‡Šä¸€ä¸‹åŒºå—é“¾æŠ€æœ¯çš„å·¥ä½œåŸç†">
                    <div class="ask-icon"><i class="fas fa-lightbulb"></i></div>
                    <div class="ask-content">
                        <h3>çŸ¥è¯†è§£ç­”</h3>
                        <p>è§£é‡Šä¸€ä¸‹åŒºå—é“¾æŠ€æœ¯çš„å·¥ä½œåŸç†</p>
                    </div>
                </div>
                <div class="ask-item" data-query="è®¾è®¡ä¸€ä¸ªPythonçˆ¬è™«è·å–æ–°é—»æ ‡é¢˜">
                    <div class="ask-icon"><i class="fas fa-code"></i></div>
                    <div class="ask-content">
                        <h3>ç¼–ç¨‹å¸®åŠ©</h3>
                        <p>è®¾è®¡ä¸€ä¸ªPythonçˆ¬è™«è·å–æ–°é—»æ ‡é¢˜</p>
                    </div>
                </div>
                <div class="ask-item" data-query="å¦‚ä½•åœ¨ä¸€å‘¨å†…å­¦ä¼šåŸºç¡€ç‘œä¼½åŠ¨ä½œï¼Ÿ">
                    <div class="ask-icon"><i class="fas fa-dumbbell"></i></div>
                    <div class="ask-content">
                        <h3>å¥åº·ç”Ÿæ´»</h3>
                        <p>å¦‚ä½•åœ¨ä¸€å‘¨å†…å­¦ä¼šåŸºç¡€ç‘œä¼½åŠ¨ä½œï¼Ÿ</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
                    </div>
                `;
                chatArea.innerHTML = chatIntroHTML;
                
                // é‡æ–°ç»‘å®šç¤ºä¾‹é—®é¢˜äº‹ä»¶
                document.querySelectorAll('.example-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const question = item.querySelector('strong').textContent;
                        chatInput.value = question;
                        sendMessage();
                    });
                });
                return;
            }
            
            // åŠ è½½èŠå¤©æ¶ˆæ¯
            chat.messages.forEach(msg => {
                addMessage(msg.content, msg.role === 'user' ? 'user' : 'ai');
                
                // å¦‚æœæœ‰æ€è€ƒè¿‡ç¨‹ï¼Œä¹Ÿæ·»åŠ æ˜¾ç¤º
                if (msg.thinking && msg.role === 'assistant') {
                    // åœ¨ç”¨æˆ·æ¶ˆæ¯å’ŒAIå›å¤ä¹‹é—´æ’å…¥æ€è€ƒè¿‡ç¨‹
                    const messageElements = document.querySelectorAll('.message');
                    const aiMessageElement = messageElements[messageElements.length - 1];
                    
                    const thinkingElement = document.createElement('div');
                    thinkingElement.className = 'message ai-message';
                    
                    const timeString = new Date(msg.timestamp).toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
                    
                    thinkingElement.innerHTML = `
                        <div class="message-content">
                            <div class="thinking-process">
                                <strong>æ€è€ƒè¿‡ç¨‹ï¼š</strong><br>
                                ${msg.thinking}
                            </div>
                        </div>
                        <div class="message-time">${timeString}</div>
                    `;
                    
                    // æ’å…¥åˆ°AIå›å¤å‰é¢
                    chatArea.insertBefore(thinkingElement, aiMessageElement);
                }
                // æ¢å¤åé¦ˆçŠ¶æ€ (æ·»åŠ åœ¨å¾ªç¯å†…)
    if (msg.role === 'assistant') {
        const messageElements = document.querySelectorAll('.ai-message');
        const lastMessage = messageElements[messageElements.length - 1];
        const likeBtn = lastMessage.querySelector('.like-btn');
        const dislikeBtn = lastMessage.querySelector('.dislike-btn');
        
        if (msg.feedback === 'like') {
            likeBtn.innerHTML = '<i class="fas fa-thumbs-up"></i>';
        } else if (msg.feedback === 'dislike') {
            dislikeBtn.innerHTML = '<i class="fas fa-thumbs-down"></i>';
        }
    }
            });
        }

        // è®¾ç½®å¼¹çª—
        settingsBtn.addEventListener('click', () => {
            modalOverlay.classList.add('show');
        });

        closeModal.addEventListener('click', () => {
            modalOverlay.classList.remove('show');
        });

        modalOverlay.addEventListener('click', (e) => {
            if (e.target === modalOverlay) {
                modalOverlay.classList.remove('show');
            }
        });

        // æ·±è‰²æ¨¡å¼åˆ‡æ¢
        darkModeToggle.addEventListener('change', () => {
            document.body.classList.toggle('dark-mode', darkModeToggle.checked);
            localStorage.setItem('darkMode', darkModeToggle.checked);
        });

        // ç»‘å®šç¤ºä¾‹é—®é¢˜äº‹ä»¶
        exampleItems.forEach(item => {
            item.addEventListener('click', () => {
                const question = item.querySelector('strong').textContent;
                chatInput.value = question;
                sendMessage();
            });
        });

        // å¤„ç†ç§¯åˆ†å……å€¼
        addCreditsBtn.addEventListener('click', () => {
            creditsModalOverlay.classList.add('show');
        });

        closeCreditsModal.addEventListener('click', () => {
            creditsModalOverlay.classList.remove('show');
        });

        creditsModalOverlay.addEventListener('click', (e) => {
            if (e.target === creditsModalOverlay) {
                creditsModalOverlay.classList.remove('show');
            }
        });

        redeemButton.addEventListener('click', () => {
            const code = redeemCode.value.trim();
            if (code === 'Aq7Rz9TwLk3JqXc5VbNm2OpQr1StUvWxYz8') {
                if (hasRedeemedCode) {
                    redeemMessage.textContent = "æ‚¨å·²ç»å…‘æ¢è¿‡ç§¯åˆ†ï¼Œæ¯å°è®¾å¤‡ä»…èƒ½å…‘æ¢ä¸€æ¬¡";
                    redeemMessage.style.color = "#ff3333";
                    redeemMessage.style.display = "block";
                } else {
                    // å¢åŠ ç§¯åˆ†
                    currentCredits += 1000;
                    saveCreditsToStorage(); // æ–°å¢
                    updateCreditsDisplay();
                    
                    // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
                    redeemMessage.textContent = "å…‘æ¢æˆåŠŸï¼å·²æ·»åŠ 1000ç§¯åˆ†";
                    redeemMessage.style.color = "green";
                    redeemMessage.style.display = "block";
                    
                    // æ ‡è®°ä¸ºå·²å…‘æ¢
                    hasRedeemedCode = true;
                    localStorage.setItem('hasRedeemedCode', 'true');
                    
                    // ç¦ç”¨å…‘æ¢æŒ‰é’®å’Œè¾“å…¥æ¡†
                    redeemButton.disabled = true;
                    redeemCode.disabled = true;
                    
                    // 3ç§’åå…³é—­å¼¹çª—
                    setTimeout(() => {
                        creditsModalOverlay.classList.remove('show');
                    }, 3000);
                }
            } else {
                redeemMessage.textContent = "å…‘æ¢ç æ— æ•ˆï¼Œè¯·é‡æ–°è¾“å…¥";
                redeemMessage.style.color = "#ff3333";
                redeemMessage.style.display = "block";
            }
        });

        // åˆå§‹åŒ–åº”ç”¨
        init();
    </script>
</body>
</html>